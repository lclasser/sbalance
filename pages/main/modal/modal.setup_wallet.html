<style>.usr_name{font-size:14px;font-weight:400;--color:#E9E6E6}.usr_email{font-size:10px;font-weight:400;--color:#E9E6E6}</style><div class="modal-dialog modal-dialog-centered modal-dialog-scrollable sb-modal" role=document><div class=modal-content><div class=modal-header><h5 class=modal-title id=modal_title>지갑 정보</h5><button class=btn-close type=button data-bs-dismiss=modal aria-label=Close></button></div><div class="modal-body sb-form"><div class=sb-row><div class=sb-col><span class=sb-label>금융사</span> <input class=sb-input type=text placeholder=금융사 id=dlg_acc_company></div></div><div class=sb-row><div class=sb-col><span class=sb-label>소유</span><div class=sb-input type=text id=dlg_acc_type></div></div></div><div class=sb-row><div class=sb-col><span class=sb-label>별칭</span> <input class=sb-input type=text placeholder="가계부에 표시될 별칭" id=dlg_acc_alias></div></div><div class=sb-row><div class=sb-col><span class=sb-label>표시</span> <select class=sb-select id=dlg_display><option value=I selected=selected>포함<option value=E>제외<option value=H>숨김</select> <button class="sb-label btn btn-secondary" type=button style=min-width:40px data-bs-toggle=popover data-bs-placement=top data-bs-container=.modal-body data-bs-html=true data-bs-content="'가계부' 표시 방법<br>제외:합산 제외<br>숨김:표시 안함">?</button></div></div><div class=sb-row><div class=sb-col><span class=sb-label>메모</span> <input class=sb-input type=text id=dlg_acc_memo placeholder=메모></div></div><div class=sb-row><div class=sb-col><span class=sb-label>생성일</span><div class=sb-input id=dlg_acc_created></div></div></div><div class=sb-row style=display:none!important><div class=sb-col><span class=sb-label>공유자</span><div class="sb-input d-flex me-0" id=dlg_sharer></div></div></div><div class=sb-row style=display:none!important><span class=sb-label>공유</span><div class="sb-input d-flex align-items-center p-1" id=dlg_sharing></div></div></div><div class=modal-footer><button type=button id=modal_rel class="btn btn-lg shared-btn">해제</button> <button type=button id=modal_del class="btn btn-lg delete-btn">삭제</button> <button type=button id=modal_ok class="btn btn-lg insert-btn ms-auto">저장</button> <button type=button class="btn btn-lg cancel-btn" data-bs-dismiss=modal>취소</button></div></div></div><script>$(function(){var i=window.dmodal.getModal(),a=window.dmodal.getParam(),t=(stracer("modal.setup_wallet.html").log("param:",a),i.find("[data-bs-toggle='popover']"));new bootstrap.Popover(t[0],{trigger:"focus"}),a.title&&i.find("#modal_title").text(a.title),stracer("modal.setup_wallet.html").log("xxx:",i.find("#modal_title").text()),null==a||null==a.acc_key?(i.find("#modal_del").hide(),i.find("#modal_rel").hide(),i.find("#dlg_acc_created").parent().hide(),i.find("#dlg_acc_type").html(getStringByAccountType("S")),i.find("#modal_ok").click(function(){window.SBalance.request("/main/account/insert",{acc_company:i.find("#dlg_acc_company").val(),acc_alias:i.find("#dlg_acc_alias").val(),acc_type:"S",acc_memo:i.find("#dlg_acc_memo").val(),acc_display:i.find("#dlg_display option:selected").val()}).then(function(t){"Y"==t.error.success?window.toast({title_class:"bg-success text-white",title_text:i.find("#modal_title").text(),mesg_text:"지갑을 추가하였습니다."}):window.toast({title_class:"bg-danger text-white",title_text:i.find("#modal_title").text(),mesg_text:`지갑 추가를 실패 했습니다. (${t.error.message})`}),window.dmodal.close(!0)})})):window.SBalance.request("/main/account/list",{acc_key:a.acc_key}).then(function(t){var e,t=t.data[0];switch(t.acc_display=t.acc_display||"I",i.find("#dlg_acc_company").val(t.acc_company),i.find("#dlg_acc_alias").val(t.acc_alias),i.find("#dlg_acc_memo").val(t.acc_memo),i.find("#dlg_display option:selected").attr("selected",null),i.find(`#dlg_display option[value="${t.acc_display}"]`).attr("selected","selected"),i.find("#dlg_acc_type").html(getStringByAccountType(t.acc_type)),t.acc_type){case"A":case"S":i.find("#modal_del").show(),i.find("#modal_rel").hide(),i.find("#dlg_sharing").parent().show(),!function n(c){i.find("#dlg_sharing").empty(),window.SBalance.request("/main/account/shared",{acc_key:c}).then(function(t){var l;t.data&&0<t.data.length?(l=$("<ul/>").addClass("list-group w-100"),t.data.forEach(function(t){var e="cancel-btn",a="읽기";t.acc_perm===Permission.READ_WRITE&&(e="update-btn",a="수정"),l.append(`<li class="list-group-item list-group-item-action p-1" share_key="${t.share_key}">`+'<div class="col ">'+`<div class="row text-break usr_name m-0">${t.usr_name}</div>`+`<div class="row text-break usr_email memo-text m-0">${t.usr_email}</div>`+'</div><div class="col-auto share_func">'+`<button class="btn ${e} me-1" type="button">${a}</button>`+'<button class="btn shared-btn" type="button">해제</button></div></li>')})):(l=$("<ul/>").addClass("list-group m-0")).append('<li class="list-group-item border-0 p-1"><div class="row text-break usr_name m-0">공유된 사용자가 없습니다.</div></li>'),i.find("#dlg_sharing").append(l),i.find("#dlg_sharer").html("본인"),i.find("#dlg_sharing").find(".share_func button.cancel-btn, button.update-btn").click(function(){var t=$(this).parent().parent().find(".usr_name").html(),e=$(this).parent().parent().find(".usr_email").html(),a=$(this).parent().parent().attr("share_key"),l=(console.log("cancel-btn:",t,e,a),console.log("has:",$(this).hasClass("cancel-btn"),$(this).hasClass("update-btn")),{share_key:a,acc_key:c,acc_perm:Permission.READ_WRITE});1==$(this).hasClass("update-btn")&&(l.acc_perm=Permission.READ_ONLY),window.SBalance.request("/main/shared/account/permit",l).then(function(t){null!=t.error&&"Y"!=t.error.success?window.toast({title_class:"bg-danger text-white",title_text:i.find("#modal_title").text(),mesg_text:`권한 변경을 실패 했습니다. (${t.error.message})`}):n(c),stracer("modal.setup_wallet.html").log(l,t)})}),i.find("#dlg_sharing").find(".share_func button.shared-btn").click(function(){var t=$(this).parent().parent().find(".usr_name").html(),e=$(this).parent().parent().find(".usr_email").html(),a=$(this).parent().parent().attr("share_key");window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.confirm.html",{title:"공유 해제 확인",content:t+`(${e}) 사용자와 공유를 해제 하시겠습니까?`,btn_confirm:"해제",btn_cancel:"취소"},function(t){var e;1==t&&(e={share_key:a,acc_key:c},window.SBalance.request("/main/shared/account/release",e).then(function(t){null!=t.error&&"Y"!=t.error.success?window.toast({title_class:"bg-danger text-white",title_text:i.find("#modal_title").text(),mesg_text:`공유 해제를 실패 했습니다. (${t.error.message})`}):n(c),stracer("modal.setup_wallet.html").log(e,t)}))})})})}(a.acc_key);break;case"L":i.find("#modal_del").hide(),i.find("#modal_rel").show(),i.find("#dlg_sharer").parent().parent().show(),e=a.acc_key,window.SBalance.request("/main/shared/account/owner",{acc_key:e}).then(function(t){i.find("#dlg_sharing").parent().hide(),i.find("#dlg_sharer").append('<div class="col ">'+`<div class="row text-break usr_name m-0">${t.data[0].usr_name}</div>`+`<div class="row text-break usr_email m-0">${t.data[0].usr_email}</div>`+"</div>")})}i.find("#dlg_acc_created").html(formatterDateSqlToFmt(new Date(t.created))),i.find("#modal_ok").click(function(){window.SBalance.request("/main/account/update",{acc_key:a.acc_key,acc_company:i.find("#dlg_acc_company").val(),acc_alias:i.find("#dlg_acc_alias").val(),acc_memo:i.find("#dlg_acc_memo").val(),acc_display:i.find("#dlg_display option:selected").val()}).then(function(t){"Y"==t.error.success?window.toast({title_class:"bg-success text-white",title_text:i.find("#modal_title").text(),mesg_text:"지갑을 업데이트하였습니다."}):window.toast({title_class:"bg-danger text-white",title_text:i.find("#modal_title").text(),mesg_text:`지갑 업데이트를 실패 했습니다. (${t.error.message})`}),window.dmodal.close(!0)})})}),i.find("#modal_del").click(function(){stracer("modal.setup_wallet.html").log("[modal.wallet.html] modal.confirm.html 1"),window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.confirm.html",{title:"삭제 확인",content:"삭제 하시겠습니까?",btn_confirm:"삭제",btn_cancel:"취소"},function(t){if(stracer("modal.setup_wallet.html").log("[modal.wallet.html] modal.confirm.html 2",t),1==t)return window.SBalance.request("/main/account/delete",{acc_key:a.acc_key}).then(function(t){null!=t.error&&"Y"!=t.error.success?window.toast({title_class:"bg-danger text-white",title_text:"지갑 삭제",mesg_text:`지갑의 삭제를 실패 했습니다. (${t.error.message})`}):window.toast({title_class:"bg-success text-white",title_text:"지갑 삭제",mesg_text:"지갑을 삭제하였습니다."}),window.dmodal.exit(!0)})})}),i.find("#modal_rel").click(function(){window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.confirm.html",{title:"공유 해제 확인",content:"공유된 지갑을 해제 하시겠습니까?",btn_confirm:"해제",btn_cancel:"취소"},function(t){if(1==t)return window.SBalance.request("/main/account/delete",{acc_key:a.acc_key}).then(function(t){null!=t.error&&"Y"!=t.error.success?window.toast({title_class:"bg-success text-white",title_text:"지갑 공유 해제",mesg_text:`지갑 공유의 해제를 실패하였습니다.(${t.error.message})`}):window.toast({title_class:"bg-success text-white",title_text:"지갑 공유 해제",mesg_text:"지갑 공유를 해제하였습니다."}),window.dmodal.exit(!0)})})})})</script>