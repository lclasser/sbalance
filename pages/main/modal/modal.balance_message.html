<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable sb-modal" role=document><div class=modal-content><div class=modal-header><h5 class=modal-title id=modal_title>상세 정보</h5><button class=btn-close type=button data-bs-dismiss=modal aria-label=Close></button></div><div class=modal-body><div class=input-row><div class=input-col><span class=input-label>날짜</span> <input class="input-value date datetimepicker-input" type=button id=sms_date data-target=#sms_date data-toggle=datetimepicker></div><div class=input-col><span class=input-label>시간</span> <input class="input-value date datetimepicker-input" type=button id=sms_time data-target=#sms_time data-toggle=datetimepicker></div></div><div class=input-row><div class=input-col><span class=input-label>지갑</span> <select class="input-value form-select" id=acc_alias></select></div></div><div class=input-row><div class=input-col><span class=input-label>구분</span> <select class="input-value form-select" id=sms_class><option value=D>입금<option value=W>출금</select></div><div class=input-col><span class=input-label>상태</span> <select class="input-value form-select" id=sms_type><option value=P>승인<option value=C>취소<option value=D>거절<option value=I>무시</select></div></div><div class=input-row><div class=input-col><span class=input-label>표시</span> <select class="input-value form-select" id=sms_display><option value=I>포함<option value=E>제외</select></div><div class=input-col><span class=input-label>추천</span> <select class="input-value form-select" id=sms_recommend><option value=->-</select></div></div><div class=input-row><div class=input-col><span class=input-label>금액</span> <input class="input-value form-control" type=text id=sms_amount> <select class="input-label form-select" id=sms_unit style=width:90px><option value=KRW selected=selected>원<option value=USD>달러</select></div></div><div class=input-row><div class=input-col><span class=input-label>내용</span> <input class="input-value form-control" type=text id=sms_contents></div></div><div class=input-row><div class=input-col><span class=input-label>분류</span> <button class="input-value form-select" type=button id=sms_category></button></div></div><div class=input-row><div class=input-col><span class=input-label>메모</span> <input class="input-value form-control" type=text id=sms_memo></div></div><div class="input-row h-100"><div class="input-col align-items-start"><label class=input-label for=msg_body>문자</label> <textarea class="input-value form-control" id=msg_body rows=3 readonly=readonly></textarea></div></div></div><div class=modal-footer><button type=button id=modal_del class="btn btn-lg btn-warning me-auto">삭제</button> <button type=button id=modal_match class="btn btn-lg btn-success">자동분류</button> <button type=button id=modal_ok class="btn btn-lg btn-primary">저장</button> <button type=button class="btn btn-lg btn-secondary" data-bs-dismiss=modal>취소</button></div></div></div><script>var param=window.dmodal.getParam(),$modal=window.dmodal.getModal();function disable_column(a){$modal.find("#"+a).attr("disabled","disabled"),$modal.find("#"+a).parent().attr("disabled","disabled")}function readonly_column(a){$modal.find("#"+a).attr("readonly","readonly")}$(function(){console.log("modal.balance_item.html...",param),null==param&&(param={is_new:!0},$modal.find("#modal_title").html("신규 등록"));var a=param.sms_date||formaterFmtDate_fromDate(),s=param.sms_time||formaterFmtTime_fromDate();switch($modal.find("#sms_date").datetimepicker({dayViewHeaderFormat:"YYYY-MM",format:"YYYY-MM-DD",locale:"ko",date:a.substring(0,4)+"-"+a.substring(4,6)+"-"+a.substring(6,8)}),$modal.find("#sms_time").datetimepicker({viewMode:"times",viewDate:!1,locale:"ko",widgetPositioning:{horizontal:"right"},format:"HH:mm",date:s.substring(0,2)+":"+s.substring(2,4)}),1==param.read_only?(readonly_column("sms_date"),readonly_column("sms_time"),disable_column("acc_alias"),disable_column("sms_class"),disable_column("sms_type"),disable_column("sms_display"),readonly_column("sms_amount"),disable_column("sms_unit"),readonly_column("sms_contents"),disable_column("sms_category"),readonly_column("sms_memo"),$modal.find("#modal_del").hide(),$modal.find("#modal_ok").hide(),$modal.find("#modal_match").hide()):"L"==param.acc_type&&(disable_column("sms_date"),disable_column("sms_time"),disable_column("acc_alias"),disable_column("sms_class"),disable_column("sms_type"),disable_column("sms_display"),disable_column("sms_amount"),disable_column("sms_unit"),disable_column("sms_contents"),$modal.find("#modal_del").attr("disabled","disabled"),$modal.find("#modal_match").hide()),disable_column("sms_recommend"),window.SBalance.request("/main/account/list",null).then(function(a){console.log("/main/account/list:",a);var e=null;a.data.forEach(function(a){var s="본인",m=null;switch(e="",a.acc_type){case"A":s="자동",m=a.acc_key,param.acc_key==a.acc_key&&(e="selected");break;case"L":if("L"!=param.acc_type)return;s="공유",m=a.acc_name,param.acc_name==a.acc_name&&(e="selected");break;case"S":s="본인",m=a.acc_key,param.acc_key==a.acc_key&&(e="selected");break;default:return}$modal.find("#acc_alias").append($(`<option class="fs_item" value="${m}" ${e}>[${a.acc_company}] ${a.acc_alias} (${s})</option>`))}),null==e&&$modal.find("#acc_alias").val("")}),param.sms_class){case"D":case"W":$modal.find("#sms_class").val(param.sms_class).prop("selected",!0);break;default:$modal.find("#sms_class").val("(없음)")}switch(param.sms_type){case"P":case"C":case"D":case"I":$modal.find("#sms_type").val(param.sms_type).prop("selected",!0);break;default:$modal.find("#sms_type").val("(없음)")}console.log("param.ci_idx:",param.ci_idx),null==param.ci_idx?$modal.find("#sms_category").html("-"):$modal.find("#sms_category").html(`${param.ci_name} (${param.cg_name})`),$modal.find("#sms_category").attr("ci_idx",param.ci_idx),$modal.find("#sms_category").on("click",function(){var a=$modal.find("#sms_category").attr("ci_idx");window.popver("https://lclasser.github.io/sbalance/pages/main/popver/select.category.html",{ci_idx:a},function(a){null!=a&&($modal.find("#sms_category").attr("ci_idx",a.ci_idx),0<a.ci_idx?$modal.find("#sms_category").html(`${a.ci_name} (${a.cg_name})`):$modal.find("#sms_category").html("-"))})}),$modal.find("#sms_display").val(param.sms_display||"I").prop("selected",!0),$modal.find("#sms_recommend").val(param.sms_recommend||"-").prop("selected",!0),$modal.find("#sms_amount").val(thousandFormatter(param.sms_amount||0)),$modal.find("#sms_amount").on("keyup",function(){var a=(a=$(this).val()).replace(/[^0-9]/g,"");return a=parseInt(a||0),$(this).val(thousandFormatter(a)),!1}),$modal.find("#sms_contents").val(param.sms_contents||""),$modal.find("#sms_memo").val(param.sms_memo||""),$modal.find("#msg_body").val(param.msg_body||"")}),$modal.find("#modal_del").click(function(){console.log("modal_del...")}),$modal.find("#modal_match").click(function(){window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.balance_match.html",param,function(a){STracer("modal.balance_item.html").log("modal.balance_match.html result:",a)})}),$modal.find("#modal_ok").click(function(){var a={},s=$modal.find("#acc_alias option:selected").val();null!=s&&param.acc_key!=s&&0<(s=s.trim()).length&&(a.target_key=s),s=$modal.find("#sms_date").val().replace(/-/g,""),param.sms_date!=s&&(a.sms_date=s),s=$modal.find("#sms_time").val().replace(/:/g,""),null!=param.sms_time&&4<param.sms_time.length?s+=param.sms_time.substring(4,6):s+="00",param.sms_time!=s&&(a.sms_time=s),s=$modal.find("#sms_class option:selected").val(),param.sms_class!=s&&(a.sms_class=s),s=$modal.find("#sms_type option:selected").val(),param.sms_type!=s&&(a.sms_type=s),s=$modal.find("#sms_category").attr("ci_idx"),param.sms_category!=s&&(a.sms_category=s),s=$modal.find("#sms_display option:selected").val(),param.sms_display!=s&&(a.sms_display=s),s=$modal.find("#sms_amount").val().replace(/[^0-9]/g,""),param.sms_amount!=s&&(a.sms_amount=s),s=$modal.find("#sms_contents").val(),param.sms_contents!=s&&(a.sms_contents=s),s=$modal.find("#sms_memo").val(),param.sms_memo!=s&&(a.sms_memo=s),console.log("inbound:",param,a),Object.keys(a).length<=0?window.dmodal.close(null):(a.acc_key=param.acc_key,a.acc_type=param.acc_type,a.acc_name=param.acc_name,a.msg_key=param.msg_key,"L"==param.acc_type&&(a.acc_key=param.acc_name),s="/main/message/update",1==param.is_new&&(s="/main/message/insert"),window.SBalance.request(s,a).then(function(a){var s=null,m="bg-secondary",e="",e="Y"==a.error.success?(console.log("message_url res:",a),0<a.data.affectedRows?(s=!0,m="bg-success","정보를 저장 했습니다."):(m="bg-secondary","저장 할 정보가 없습니다.")):(console.error("message_url res:",a),m="bg-danger",`저장을 실패 했습니다. (${a.error.message})`);window.toast({title_class:m+" text-white",title_text:"상세 정보",mesg_text:e}),window.dmodal.close(s)}))})</script>