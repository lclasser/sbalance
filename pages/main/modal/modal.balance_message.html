<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable sb-modal" role=document><div class=modal-content><div class=modal-header><h5 class=modal-title id=modal_title>상세 정보</h5><button class=btn-close type=button data-bs-dismiss=modal aria-label=Close></button></div><div class="modal-body sb-form"><div class=sb-row><div class=sb-col><span class=sb-label>날짜</span> <input class="sb-input date datetimepicker-input" type=button id=sms_date data-target=#sms_date data-toggle=datetimepicker></div><div class=sb-col><span class=sb-label>시간</span> <input class="sb-input date datetimepicker-input" type=button id=sms_time data-target=#sms_time data-toggle=datetimepicker></div></div><div class=sb-row><div class=sb-col><span class=sb-label>지갑</span> <select class=sb-select id=wlt_alias></select></div></div><div class=sb-row><div class=sb-col><span class=sb-label>구분</span> <select class=sb-select id=sms_class><option value=D>입금<option value=W>출금</select></div><div class=sb-col><span class=sb-label>상태</span> <select class=sb-select id=sms_type><option value=P>승인<option value=C>취소<option value=D>거절<option value=I>무시</select></div></div><div class=sb-row><div class=sb-col><span class=sb-label>표시</span> <select class=sb-select id=sms_display><option value=I>포함<option value=E>제외</select></div><div class=sb-col><span class=sb-label>할부</span> <input class=sb-input type=number id=sms_iment placeholder=일시불></div></div><div class=sb-row><div class="sb-col flex-fill"><span class=sb-label>금액</span> <input class=sb-input type=text id=sms_amount> <select class="sb-label w-3 sb-select" id=sms_unit style=--width:90px><option value=KRW selected=selected>원<option value=USD>$</select></div></div><div class=sb-row><div class=sb-col><span class=sb-label>내용</span> <input class=sb-input type=text id=sms_contents> <button type=button class="sb-label w-3 btn p-0" id=sms_where>위치</button></div></div><div class=sb-row><div class=sb-col><span class=sb-label>분류</span> <button class=sb-select type=button id=sms_category></button></div></div><div class=sb-row><div class=sb-col><span class=sb-label>메모</span> <input class=sb-input type=text id=sms_memo></div></div><div class="sb-row h-100"><div class="sb-col align-items-start"><label class=sb-label for=msg_body>문자</label> <textarea class=sb-input id=msg_body rows=3 readonly=readonly></textarea></div></div></div><div class=modal-footer><button type=button id=modal_del class="btn btn-lg btn-danger me-auto">삭제</button> <button type=button id=modal_match class="btn btn-lg btn-success">자동분류</button> <button type=button id=modal_ok class="btn btn-lg btn-primary">저장</button> <button type=button class="btn btn-lg btn-secondary" data-bs-dismiss=modal>취소</button></div></div></div><script>function disable_column(e,s){e.find("#"+s).attr("disabled","disabled"),e.find("#"+s).parent().attr("disabled","disabled")}function readonly_column(e,s){e.find("#"+s).attr("readonly","readonly")}function get_column_values(e,s){var a={};return temp_val=e.find("#sms_date").val().replace(/-/g,""),s.sms_date!=temp_val&&(a.sms_date=temp_val),temp_val=e.find("#sms_time").val().replace(/:/g,""),null!=s.sms_time&&4<s.sms_time.length?temp_val+=s.sms_time.substring(4,6):temp_val+="00",s.sms_time!=temp_val&&(a.sms_time=temp_val),a.target_key=e.find("#wlt_alias option:selected").val(),(null==a.target_key||a.target_key.length<=0||a.target_key==s.acc_key)&&delete a.target_key,temp_val=e.find("#sms_class option:selected").val(),s.sms_class!=temp_val&&(a.sms_class=temp_val),temp_val=e.find("#sms_type option:selected").val(),s.sms_type!=temp_val&&(a.sms_type=temp_val),temp_val=e.find("#sms_display option:selected").val(),s.sms_display!=temp_val&&(a.sms_display=temp_val),temp_val=e.find("#sms_iment").val().replace(/[^0-9]/g,""),temp_val=toInteger(temp_val),toInteger(s.sms_iment)!=temp_val&&(a.sms_iment=temp_val),temp_val=e.find("#sms_amount").val().replace(/[^0-9]/g,""),s.sms_amount!=temp_val&&(a.sms_amount=temp_val),temp_val=e.find("#sms_contents").val(),s.sms_contents!=temp_val&&(a.sms_contents=temp_val),temp_val=e.find("#sms_category").attr("ci_idx"),s.sms_category!=temp_val&&(a.sms_category=temp_val),temp_val=e.find("#sms_memo").val(),s.sms_memo!=temp_val&&(a.sms_memo=temp_val),a}function set_column_values(t,l,e){var s=e.sms_date||formaterFmtDate_fromDate(),a=e.sms_time||formaterFmtTime_fromDate(),m=(t.find("#sms_date").datetimepicker({dayViewHeaderFormat:"YYYY-MM",format:"YYYY-MM-DD",locale:"ko",date:s.substring(0,4)+"-"+s.substring(4,6)+"-"+s.substring(6,8)}),t.find("#sms_time").datetimepicker({viewMode:"times",viewDate:!1,locale:"ko",widgetPositioning:{horizontal:"right"},format:"HH:mm",date:a.substring(0,2)+":"+a.substring(2,4)}),e.target_key||l.acc_key);switch(window.SBalance.request("/main/account/list",null).then(function(e){stracer("page.balance_message.html").log("/main/account/list:",e);var a=null;e.data.forEach(function(e){var s="본인";switch(e.acc_alias=e.acc_alias||e.wlt_alias,e.acc_type){case"L":if("L"!=l.acc_type)return;s="공유";break;case"A":s="자동";break;case"S":s="본인","현금지갑"==e.acc_name&&null==a&&(a=e.acc_key);break;default:return}null==a&&m==e.acc_key&&(a=e.acc_key),t.find("#wlt_alias").append($(`<option class="fs_item" value="${e.acc_key}">[${e.acc_company}] ${e.acc_alias} (${s})</option>`))}),null==a?t.find("#wlt_alias").append($('<option class="fs_item" value="" selected hidden>(지갑을 선택하세요.)</option>')):t.find("#wlt_alias").val(a).prop("selected",!0)}),e.sms_class){case"D":case"W":t.find("#sms_class").val(e.sms_class).prop("selected",!0);break;default:t.find("#sms_class").val("(없음)")}switch(e.sms_type){case"P":case"C":case"D":case"I":t.find("#sms_type").val(e.sms_type).prop("selected",!0);break;default:t.find("#sms_type").val("(없음)")}t.find("#sms_display").val(e.sms_display||"I").prop("selected",!0),t.find("#sms_iment").val(toInteger(e.sms_iment)||""),t.find("#sms_amount").val(thousandFormatter(e.sms_amount||0)),t.find("#sms_amount").on("keyup",function(){var e=(e=$(this).val()).replace(/[^0-9]/g,"");return e=parseInt(e||0),$(this).val(thousandFormatter(e)),!1});var n,i=null;null==(i=null!=e.msg_gps&&(null!=(s=e.msg_gps.split(","))||2<=s.length)?s:i)?t.find("#sms_where").attr("disabled","disabled"):(t.find("#sms_where").click(function(){var e;"disabled"!=t.find("#sms_where").attr("disabled")&&(e=t.find("#sms_contents").val()||"위치",e=`http://map.naver.com/index.nhn?enc=utf8&level=2&lat=${i[0]}&lng=${i[1]}&pinTitle=${e}&pinType=SITE`,window.open(encodeURI(e)))}),n=null,t.find("#sms_where").mousedown(function(){n=setTimeout(function(){window.SBalance.request("/main/message/clear/msg_gps",{acc_key:e.acc_key,msg_key:e.msg_key}).then(function(e){t.find("#sms_where").attr("disabled","disabled")})},3e3)}).mouseup(function(){n&&clearTimeout(n)}).mouseout(function(){n&&clearTimeout(n)})),t.find("#sms_contents").val(e.sms_contents||""),stracer("page.balance_message.html").log("values.sms_category:",e.sms_category),null==e.grp_mark||0==toInteger(e.sms_category)?t.find("#sms_category").html("-"):t.find("#sms_category").html(`${e.ci_name} (${e.grp_mark})`),t.find("#sms_category").attr("ci_idx",e.sms_category),t.find("#sms_category").on("click",function(){var e=t.find("#sms_category").attr("ci_idx");window.popver("https://lclasser.github.io/sbalance/pages/main/popver/select.category.html",{ci_idx:e},function(e){null!=e&&(t.find("#sms_category").attr("ci_idx",e.ci_idx),0<e.ci_idx?(t.find("#sms_category").html(`${e.ci_name} (${e.cg_alias})`),l.ci_name=e.ci_name,l.grp_mark=e.cg_alias):t.find("#sms_category").html("-"))})}),t.find("#sms_memo").val(e.sms_memo||""),t.find("#msg_body").val(e.msg_body||"")}$(function(){var a=window.dmodal.getModal(),t=window.dmodal.getParam();stracer("page.balance_message.html").log("param:",t),null==t&&(t={is_new:!0,acc_perm:Permission.READ_WRITE,values:{sms_class:"W",sms_type:"P",sms_display:"I"}},a.find("#modal_title").html("신규 등록")),disable_column(a,"sms_recommend"),t.values=Object.assign({},t,t.values),set_column_values(a,t,t.values),t.acc_perm!==Permission.READ_WRITE&&(t.read_only=!0),1==t.read_only?(disable_column(a,"sms_date"),disable_column(a,"sms_time"),disable_column(a,"wlt_alias"),disable_column(a,"sms_class"),disable_column(a,"sms_type"),disable_column(a,"sms_display"),disable_column(a,"sms_iment"),disable_column(a,"sms_amount"),disable_column(a,"sms_unit"),disable_column(a,"sms_contents"),disable_column(a,"sms_category"),disable_column(a,"sms_memo"),disable_column(a,"msg_body"),a.find("#modal_del").hide(),a.find("#modal_ok").hide(),a.find("#modal_match").hide()):"L"==t.acc_type&&(disable_column(a,"sms_date"),disable_column(a,"sms_time"),disable_column(a,"wlt_alias"),disable_column(a,"sms_class"),disable_column(a,"sms_type"),disable_column(a,"sms_display"),disable_column(a,"sms_iment"),disable_column(a,"sms_amount"),disable_column(a,"sms_unit"),disable_column(a,"sms_contents"),a.find("#modal_del").attr("disabled","disabled"),a.find("#modal_match").hide()),a.find("#modal_match").click(function(){t.values=get_column_values(a,t);var e=Object.assign({},t,t.values);e.acc_key=e.target_key||e.acc_key,window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.balance_match.html",e,function(e){stracer("modal.balance_item.html").log("modal.balance_match.html result:",e)})}),a.find("#modal_ok").click(function(){var e,s=get_column_values(a,t);stracer("page.balance_message.html").log("inbound:",t,s),Object.keys(s).length<=0?window.dmodal.close(null):(s.acc_key=t.acc_key,s.acc_type=t.acc_type,s.msg_key=t.msg_key,e="/main/message/update",1==t.is_new&&(e="/main/message/insert"),window.SBalance.request(e,s).then(function(e){var s=null,a="bg-secondary",t="";stracer("page.balance_message.html").log("message_url res:",e),t=0<e.data.affectedRows?(s=!0,a="bg-success","메시지를 저장 했습니다."):(a="bg-secondary","변경되 내용이 없습니다."),window.toast({title_class:a+" text-white",title_text:"상세 정보",mesg_text:t}),window.dmodal.close(s)}))}),a.find("#modal_del").click(function(){stracer("page.balance_message.html").log("modal_del..."),window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.confirm.html",{title:"삭제 확인",content:`"${t.sms_contents}"(${thousandFormatter(t.sms_amount||0)})를 삭제 하시겠습니까?`,btn_confirm:"삭제",btn_cancel:"취소"},function(e){if(1==e)return e={acc_key:t.acc_key,acc_type:t.acc_type,msg_key:t.msg_key},window.SBalance.request("/main/message/delete",e).then(function(e){window.toast({title_class:"bg-success text-white",title_text:"삭제 완료",mesg_text:"메시지를 삭제 했습니다."}),window.dmodal.exit(!0)})})})})</script>