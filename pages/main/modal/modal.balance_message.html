<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable sb-modal" role=document><div class=modal-content><div class=modal-header><h5 class=modal-title id=modal_title>상세 정보</h5><button class=btn-close type=button data-bs-dismiss=modal aria-label=Close></button></div><div class=modal-body><div class=input-row><div class=input-col><span class=input-label>날짜</span> <input class="input-value date datetimepicker-input" type=button id=sms_date data-target=#sms_date data-toggle=datetimepicker></div><div class=input-col><span class=input-label>시간</span> <input class="input-value date datetimepicker-input" type=button id=sms_time data-target=#sms_time data-toggle=datetimepicker></div></div><div class=input-row><div class=input-col><span class=input-label>지갑</span> <select class="input-value form-select" id=acc_alias></select></div></div><div class=input-row><div class=input-col><span class=input-label>구분</span> <select class="input-value form-select" id=sms_class><option value=D>입금<option value=W>출금</select></div><div class=input-col><span class=input-label>상태</span> <select class="input-value form-select" id=sms_type><option value=P>승인<option value=C>취소<option value=D>거절<option value=I>무시</select></div></div><div class=input-row><div class=input-col><span class=input-label>표시</span> <select class="input-value form-select" id=sms_display><option value=I>포함<option value=E>제외</select></div><div class=input-col><span class=input-label>할부</span> <input class="input-value form-control" type=number id=sms_iment placeholder=일시불></div></div><div class=input-row><div class="input-col flex-fill"><span class=input-label>금액</span> <input class="input-value form-control" type=text id=sms_amount> <select class="input-label form-select" id=sms_unit style=--width:90px><option value=KRW selected=selected>원<option value=USD>$</select></div></div><div class=input-row><div class=input-col><span class=input-label>내용</span> <input class="input-value form-control" type=text id=sms_contents></div></div><div class=input-row><div class=input-col><span class=input-label>분류</span> <button class="input-value form-select" type=button id=sms_category></button></div></div><div class=input-row><div class=input-col><span class=input-label>메모</span> <input class="input-value form-control" type=text id=sms_memo></div></div><div class="input-row h-100"><div class="input-col align-items-start"><label class=input-label for=msg_body>문자</label> <textarea class="input-value form-control" id=msg_body rows=3 readonly=readonly></textarea></div></div></div><div class=modal-footer><button type=button id=modal_del class="btn btn-lg btn-warning me-auto">삭제</button> <button type=button id=modal_match class="btn btn-lg btn-success">자동분류</button> <button type=button id=modal_ok class="btn btn-lg btn-primary">저장</button> <button type=button class="btn btn-lg btn-secondary" data-bs-dismiss=modal>취소</button></div></div></div><script>function disable_column(e,s){e.find("#"+s).attr("disabled","disabled"),e.find("#"+s).parent().attr("disabled","disabled")}function readonly_column(e,s){e.find("#"+s).attr("readonly","readonly")}function get_column_values(e,s){var a={};return temp_val=e.find("#sms_date").val().replace(/-/g,""),s.sms_date!=temp_val&&(a.sms_date=temp_val),temp_val=e.find("#sms_time").val().replace(/:/g,""),null!=s.sms_time&&4<s.sms_time.length?temp_val+=s.sms_time.substring(4,6):temp_val+="00",s.sms_time!=temp_val&&(a.sms_time=temp_val),a.target_key=e.find("#acc_alias option:selected").val(),(null==a.target_key||a.target_key.length<=0||a.target_key==s.acc_key)&&delete a.target_key,temp_val=e.find("#sms_class option:selected").val(),s.sms_class!=temp_val&&(a.sms_class=temp_val),temp_val=e.find("#sms_type option:selected").val(),s.sms_type!=temp_val&&(a.sms_type=temp_val),temp_val=e.find("#sms_display option:selected").val(),s.sms_display!=temp_val&&(a.sms_display=temp_val),temp_val=e.find("#sms_iment").val().replace(/[^0-9]/g,""),temp_val=toInteger(temp_val),toInteger(s.sms_iment)!=temp_val&&(a.sms_iment=temp_val),temp_val=e.find("#sms_amount").val().replace(/[^0-9]/g,""),s.sms_amount!=temp_val&&(a.sms_amount=temp_val),temp_val=e.find("#sms_contents").val(),s.sms_contents!=temp_val&&(a.sms_contents=temp_val),temp_val=e.find("#sms_category").attr("ci_idx"),s.sms_category!=temp_val&&(a.sms_category=temp_val),temp_val=e.find("#sms_memo").val(),s.sms_memo!=temp_val&&(a.sms_memo=temp_val),a}function set_column_values(m,n,e){var s=e.sms_date||formaterFmtDate_fromDate(),a=e.sms_time||formaterFmtTime_fromDate(),c=(m.find("#sms_date").datetimepicker({dayViewHeaderFormat:"YYYY-MM",format:"YYYY-MM-DD",locale:"ko",date:s.substring(0,4)+"-"+s.substring(4,6)+"-"+s.substring(6,8)}),m.find("#sms_time").datetimepicker({viewMode:"times",viewDate:!1,locale:"ko",widgetPositioning:{horizontal:"right"},format:"HH:mm",date:a.substring(0,2)+":"+a.substring(2,4)}),e.target_key||n.acc_key);switch(window.SBalance.request("/main/account/list",null).then(function(e){console.log("/main/account/list:",e);var l=null;e.data.forEach(function(e){var s="본인",a=null,t=null;switch(e.acc_type){case"A":s="자동",a=e.acc_key,c==e.acc_key&&(t="selected");break;case"L":if("L"!=n.acc_type)return;s="공유",a=e.acc_name,n.acc_name==e.acc_name&&(t="selected");break;case"S":s="본인",a=e.acc_key,c==e.acc_key&&(t="selected");break;default:return}null!=t&&(l=!0),m.find("#acc_alias").append($(`<option class="fs_item" value="${a}" ${t||""}>[${e.acc_company}] ${e.acc_alias} (${s})</option>`))}),1!=l&&m.find("#acc_alias").append($('<option class="fs_item" value="" selected hidden>(지갑을 선택하세요.)</option>'))}),e.sms_class){case"D":case"W":m.find("#sms_class").val(e.sms_class).prop("selected",!0);break;default:m.find("#sms_class").val("(없음)")}switch(e.sms_type){case"P":case"C":case"D":case"I":m.find("#sms_type").val(e.sms_type).prop("selected",!0);break;default:m.find("#sms_type").val("(없음)")}m.find("#sms_display").val(e.sms_display||"I").prop("selected",!0),m.find("#sms_iment").val(toInteger(e.sms_iment)||""),m.find("#sms_amount").val(thousandFormatter(e.sms_amount||0)),m.find("#sms_amount").on("keyup",function(){var e=(e=$(this).val()).replace(/[^0-9]/g,"");return e=parseInt(e||0),$(this).val(thousandFormatter(e)),!1}),m.find("#sms_contents").val(e.sms_contents||""),console.log("values.sms_category:",e.sms_category),0==toInteger(e.sms_category)?m.find("#sms_category").html("-"):m.find("#sms_category").html(`${e.ci_name} (${e.cg_name})`),m.find("#sms_category").attr("ci_idx",e.sms_category),m.find("#sms_category").on("click",function(){var e=m.find("#sms_category").attr("ci_idx");window.popver("https://lclasser.github.io/sbalance/pages/main/popver/select.category.html",{ci_idx:e},function(e){null!=e&&(m.find("#sms_category").attr("ci_idx",e.ci_idx),0<e.ci_idx?(m.find("#sms_category").html(`${e.ci_name} (${e.cg_name})`),n.ci_name=e.ci_name,n.cg_name=e.cg_name):m.find("#sms_category").html("-"))})}),m.find("#sms_memo").val(e.sms_memo||""),m.find("#msg_body").val(e.msg_body||"")}$(function(){var a=window.dmodal.getParam(),t=window.dmodal.getModal(),e=(console.log("modal.balance_item.html...",a),null==a&&(a={is_new:!0},t.find("#modal_title").html("신규 등록")),disable_column(t,"sms_recommend"),Object.assign({},a,a.values));a.values=null,set_column_values(t,a,e),1==a.read_only?(readonly_column(t,"sms_date"),readonly_column(t,"sms_time"),disable_column(t,"acc_alias"),disable_column(t,"sms_class"),disable_column(t,"sms_type"),disable_column(t,"sms_display"),readonly_column(t,"sms_amount"),disable_column(t,"sms_unit"),readonly_column(t,"sms_contents"),disable_column(t,"sms_category"),readonly_column(t,"sms_memo"),t.find("#modal_del").hide(),t.find("#modal_ok").hide(),t.find("#modal_match").hide()):"L"==a.acc_type&&(disable_column(t,"sms_date"),disable_column(t,"sms_time"),disable_column(t,"acc_alias"),disable_column(t,"sms_class"),disable_column(t,"sms_type"),disable_column(t,"sms_display"),disable_column(t,"sms_amount"),disable_column(t,"sms_unit"),disable_column(t,"sms_contents"),t.find("#modal_del").attr("disabled","disabled"),t.find("#modal_match").hide()),t.find("#modal_match").click(function(){a.values=get_column_values(t,a);var e=Object.assign({},a,a.values);e.acc_key=e.target_key||e.acc_key,e.sms_category=a.values.sms_category||a.sms_category,window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.balance_match.html",e,function(e){STracer("modal.balance_item.html").log("modal.balance_match.html result:",e)})}),t.find("#modal_ok").click(function(){var e,s=get_column_values(t,a);console.log("inbound:",a,s),Object.keys(s).length<=0?window.dmodal.close(null):(s.acc_key=a.acc_key,s.acc_type=a.acc_type,s.acc_name=a.acc_name,s.msg_key=a.msg_key,"L"==a.acc_type&&(s.acc_key=a.acc_name),e="/main/message/update",1==a.is_new&&(e="/main/message/insert"),window.SBalance.request(e,s).then(function(e){var s=null,a="bg-secondary",t="",t="Y"==e.error.success?(console.log("message_url res:",e),0<e.data.affectedRows?(s=!0,a="bg-success","정보를 저장 했습니다."):(a="bg-secondary","저장 할 정보가 없습니다.")):(console.error("message_url res:",e),a="bg-danger",`저장을 실패 했습니다. (${e.error.message})`);window.toast({title_class:a+" text-white",title_text:"상세 정보",mesg_text:t}),window.dmodal.close(s)}))}),t.find("#modal_del").click(function(){console.log("modal_del...")})})</script>