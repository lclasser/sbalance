<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable sb-modal" role=document><div class=modal-content><div class=modal-header><h5 class=modal-title id=modal_title>상세 정보</h5><button class=btn-close type=button data-bs-dismiss=modal aria-label=Close></button></div><div class=modal-body><div class=input-row><div class=input-col><span class=input-label>날짜</span> <input class="input-value date datetimepicker-input" type=button id=sms_date data-target=#sms_date data-toggle=datetimepicker></div><div class=input-col><span class=input-label>시간</span> <input class="input-value date datetimepicker-input" type=button id=sms_time data-target=#sms_time data-toggle=datetimepicker></div></div><div class=input-row><div class=input-col><span class=input-label>지갑</span> <select class="input-value form-select" id=acc_alias></select></div></div><div class=input-row><div class=input-col><span class=input-label>구분</span> <select class="input-value form-select" id=sms_class><option value=D>입금<option value=W>출금</select></div><div class=input-col><span class=input-label>상태</span> <select class="input-value form-select" id=sms_type><option value=P>승인<option value=C>취소<option value=D>거절<option value=I>무시</select></div></div><div class=input-row><div class=input-col><span class=input-label>표시</span> <select class="input-value form-select" id=sms_display><option value=I>포함<option value=E>제외</select></div><div class=input-col><span class=input-label>추천</span> <select class="input-value form-select" id=sms_recommend><option value=->-</select></div></div><div class=input-row><div class=input-col><span class=input-label>금액</span> <input class="input-value form-control" type=text id=sms_amount> <select class="input-label form-select" id=sms_unit style=width:90px><option value=KRW selected=selected>원<option value=USD>달러</select></div></div><div class=input-row><div class=input-col><span class=input-label>내용</span> <input class="input-value form-control" type=text id=sms_contents></div></div><div class=input-row><div class=input-col><span class=input-label>분류</span> <button class="input-value form-select" type=button id=sms_category></button></div></div><div class=input-row><div class=input-col><span class=input-label>메모</span> <input class="input-value form-control" type=text id=sms_memo></div></div><div class="input-row h-100"><div class="input-col align-items-start"><label class=input-label for=msg_body>문자</label> <textarea class="input-value form-control" id=msg_body rows=3 readonly=readonly></textarea></div></div></div><div class=modal-footer><button type=button id=modal_del class="btn btn-lg btn-warning me-auto">삭제</button> <button type=button id=modal_match class="btn btn-lg btn-success">자동분류</button> <button type=button id=modal_ok class="btn btn-lg btn-primary">저장</button> <button type=button class="btn btn-lg btn-secondary" data-bs-dismiss=modal>취소</button></div></div></div><script>var param=window.dmodal.getParam(),$modal=window.dmodal.getModal();function disable_column(a){$modal.find("#"+a).attr("disabled","disabled"),$modal.find("#"+a).parent().attr("disabled","disabled")}function readonly_column(a){$modal.find("#"+a).attr("readonly","readonly")}function get_column_values(){var a={};return null!=(temp_val=$modal.find("#acc_alias option:selected").val())&&param.acc_key!=temp_val&&0<(temp_val=temp_val.trim()).length&&(a.target_key=temp_val),temp_val=$modal.find("#sms_date").val().replace(/-/g,""),param.sms_date!=temp_val&&(a.sms_date=temp_val),temp_val=$modal.find("#sms_time").val().replace(/:/g,""),null!=param.sms_time&&4<param.sms_time.length?temp_val+=param.sms_time.substring(4,6):temp_val+="00",param.sms_time!=temp_val&&(a.sms_time=temp_val),temp_val=$modal.find("#sms_class option:selected").val(),param.sms_class!=temp_val&&(a.sms_class=temp_val),temp_val=$modal.find("#sms_type option:selected").val(),param.sms_type!=temp_val&&(a.sms_type=temp_val),temp_val=$modal.find("#sms_category").attr("ci_idx"),param.sms_category!=temp_val&&(a.sms_category=temp_val),temp_val=$modal.find("#sms_display option:selected").val(),param.sms_display!=temp_val&&(a.sms_display=temp_val),temp_val=$modal.find("#sms_amount").val().replace(/[^0-9]/g,""),param.sms_amount!=temp_val&&(a.sms_amount=temp_val),temp_val=$modal.find("#sms_contents").val(),param.sms_contents!=temp_val&&(a.sms_contents=temp_val),temp_val=$modal.find("#sms_memo").val(),param.sms_memo!=temp_val&&(a.sms_memo=temp_val),a}function set_column_values(a){var e=a.sms_date||formaterFmtDate_fromDate(),m=a.sms_time||formaterFmtTime_fromDate(),l=($modal.find("#sms_date").datetimepicker({dayViewHeaderFormat:"YYYY-MM",format:"YYYY-MM-DD",locale:"ko",date:e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6,8)}),$modal.find("#sms_time").datetimepicker({viewMode:"times",viewDate:!1,locale:"ko",widgetPositioning:{horizontal:"right"},format:"HH:mm",date:m.substring(0,2)+":"+m.substring(2,4)}),a.target_key||a.acc_key);switch(window.SBalance.request("/main/account/list",null).then(function(a){console.log("/main/account/list:",a);var s=null;a.data.forEach(function(a){var e="본인",m=null;switch(s="",a.acc_type){case"A":e="자동",m=a.acc_key,l==a.acc_key&&(s="selected");break;case"L":if("L"!=param.acc_type)return;e="공유",m=a.acc_name,param.acc_name==a.acc_name&&(s="selected");break;case"S":e="본인",m=a.acc_key,l==a.acc_key&&(s="selected");break;default:return}$modal.find("#acc_alias").append($(`<option class="fs_item" value="${m}" ${s}>[${a.acc_company}] ${a.acc_alias} (${e})</option>`))}),null==s&&$modal.find("#acc_alias").val("")}),a.sms_class){case"D":case"W":$modal.find("#sms_class").val(a.sms_class).prop("selected",!0);break;default:$modal.find("#sms_class").val("(없음)")}switch(a.sms_type){case"P":case"C":case"D":case"I":$modal.find("#sms_type").val(a.sms_type).prop("selected",!0);break;default:$modal.find("#sms_type").val("(없음)")}console.log("values.sms_category:",a.sms_category),0==toInteger(a.sms_category)?$modal.find("#sms_category").html("-"):$modal.find("#sms_category").html(`${a.ci_name} (${a.cg_name})`),$modal.find("#sms_category").attr("ci_idx",a.sms_category),$modal.find("#sms_category").on("click",function(){var a=$modal.find("#sms_category").attr("ci_idx");window.popver("https://lclasser.github.io/sbalance/pages/main/popver/select.category.html",{ci_idx:a},function(a){null!=a&&($modal.find("#sms_category").attr("ci_idx",a.ci_idx),0<a.ci_idx?($modal.find("#sms_category").html(`${a.ci_name} (${a.cg_name})`),param.ci_name=a.ci_name,param.cg_name=a.cg_name):$modal.find("#sms_category").html("-"))})}),$modal.find("#sms_display").val(a.sms_display||"I").prop("selected",!0),$modal.find("#sms_recommend").val(a.sms_recommend||"-").prop("selected",!0),$modal.find("#sms_amount").val(thousandFormatter(a.sms_amount||0)),$modal.find("#sms_amount").on("keyup",function(){var a=(a=$(this).val()).replace(/[^0-9]/g,"");return a=parseInt(a||0),$(this).val(thousandFormatter(a)),!1}),$modal.find("#sms_contents").val(a.sms_contents||""),$modal.find("#sms_memo").val(a.sms_memo||""),$modal.find("#msg_body").val(a.msg_body||"")}$(function(){console.log("modal.balance_item.html...",param),null==param&&(param={is_new:!0},$modal.find("#modal_title").html("신규 등록")),disable_column("sms_recommend");var a=Object.assign({},param,param.values);param.values=null,set_column_values(a),1==param.read_only?(readonly_column("sms_date"),readonly_column("sms_time"),disable_column("acc_alias"),disable_column("sms_class"),disable_column("sms_type"),disable_column("sms_display"),readonly_column("sms_amount"),disable_column("sms_unit"),readonly_column("sms_contents"),disable_column("sms_category"),readonly_column("sms_memo"),$modal.find("#modal_del").hide(),$modal.find("#modal_ok").hide(),$modal.find("#modal_match").hide()):"L"==param.acc_type&&(disable_column("sms_date"),disable_column("sms_time"),disable_column("acc_alias"),disable_column("sms_class"),disable_column("sms_type"),disable_column("sms_display"),disable_column("sms_amount"),disable_column("sms_unit"),disable_column("sms_contents"),$modal.find("#modal_del").attr("disabled","disabled"),$modal.find("#modal_match").hide())}),$modal.find("#modal_del").click(function(){console.log("modal_del...")}),$modal.find("#modal_match").click(function(){param.values=get_column_values();var a=Object.assign({},param,param.values);a.acc_key=a.target_key,a.sms_category=param.values.sms_category,window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.balance_match.html",a,function(a){STracer("modal.balance_item.html").log("modal.balance_match.html result:",a)})}),$modal.find("#modal_ok").click(function(){var a,e=get_column_values();console.log("inbound:",param,e),Object.keys(e).length<=0?window.dmodal.close(null):(e.acc_key=param.acc_key,e.acc_type=param.acc_type,e.acc_name=param.acc_name,e.msg_key=param.msg_key,"L"==param.acc_type&&(e.acc_key=param.acc_name),a="/main/message/update",1==param.is_new&&(a="/main/message/insert"),window.SBalance.request(a,e).then(function(a){var e=null,m="bg-secondary",s="",s="Y"==a.error.success?(console.log("message_url res:",a),0<a.data.affectedRows?(e=!0,m="bg-success","정보를 저장 했습니다."):(m="bg-secondary","저장 할 정보가 없습니다.")):(console.error("message_url res:",a),m="bg-danger",`저장을 실패 했습니다. (${a.error.message})`);window.toast({title_class:m+" text-white",title_text:"상세 정보",mesg_text:s}),window.dmodal.close(e)}))})</script>