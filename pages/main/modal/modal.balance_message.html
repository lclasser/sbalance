<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable sb-modal" role=document><div class=modal-content><div class=modal-header><h5 class=modal-title id=modal_title>상세 정보</h5><button class=btn-close type=button data-bs-dismiss=modal aria-label=Close></button></div><div class="modal-body sb-form"><div class=sb-row><div class=sb-col><span class=sb-label>날짜</span> <input class="sb-input date datetimepicker-input" type=button id=sms_date data-target=#sms_date data-toggle=datetimepicker></div><div class=sb-col><span class=sb-label>시간</span> <input class="sb-input date datetimepicker-input" type=button id=sms_time data-target=#sms_time data-toggle=datetimepicker></div></div><div class=sb-row><div class=sb-col><span class=sb-label>지갑</span> <select class=sb-select id=acc_alias></select></div></div><div class=sb-row><div class=sb-col><span class=sb-label>구분</span> <select class=sb-select id=sms_class><option value=D>입금<option value=W>출금</select></div><div class=sb-col><span class=sb-label>상태</span> <select class=sb-select id=sms_type><option value=P>승인<option value=C>취소<option value=D>거절<option value=I>무시</select></div></div><div class=sb-row><div class=sb-col><span class=sb-label>표시</span> <select class=sb-select id=sms_display><option value=I>포함<option value=E>제외</select></div><div class=sb-col><span class=sb-label>할부</span> <input class=sb-input type=number id=sms_iment placeholder=일시불></div></div><div class=sb-row><div class="sb-col flex-fill"><span class=sb-label>금액</span> <input class=sb-input type=text id=sms_amount> <select class="sb-label sb-select w-3" id=sms_unit style=--width:90px><option value=KRW selected=selected>원<option value=USD>$</select></div></div><div class=sb-row><div class=sb-col><span class=sb-label>내용</span> <input class=sb-input type=text id=sms_contents></div></div><div class=sb-row><div class=sb-col><span class=sb-label>분류</span> <button class=sb-select type=button id=sms_category></button></div></div><div class=sb-row><div class=sb-col><span class=sb-label>메모</span> <input class=sb-input type=text id=sms_memo></div></div><div class="sb-row h-100"><div class="sb-col align-items-start"><label class=sb-label for=msg_body>문자</label> <textarea class=sb-input id=msg_body rows=3 readonly=readonly></textarea></div></div></div><div class=modal-footer><button type=button id=modal_del class="btn btn-lg btn-danger me-auto">삭제</button> <button type=button id=modal_match class="btn btn-lg btn-success">자동분류</button> <button type=button id=modal_ok class="btn btn-lg btn-primary">저장</button> <button type=button class="btn btn-lg btn-secondary" data-bs-dismiss=modal>취소</button></div></div></div><script>function disable_column(e,a){e.find("#"+a).attr("disabled","disabled"),e.find("#"+a).parent().attr("disabled","disabled")}function readonly_column(e,a){e.find("#"+a).attr("readonly","readonly")}function get_column_values(e,a){var s={};return temp_val=e.find("#sms_date").val().replace(/-/g,""),a.sms_date!=temp_val&&(s.sms_date=temp_val),temp_val=e.find("#sms_time").val().replace(/:/g,""),null!=a.sms_time&&4<a.sms_time.length?temp_val+=a.sms_time.substring(4,6):temp_val+="00",a.sms_time!=temp_val&&(s.sms_time=temp_val),s.target_key=e.find("#acc_alias option:selected").val(),(null==s.target_key||s.target_key.length<=0||s.target_key==a.acc_key)&&delete s.target_key,temp_val=e.find("#sms_class option:selected").val(),a.sms_class!=temp_val&&(s.sms_class=temp_val),temp_val=e.find("#sms_type option:selected").val(),a.sms_type!=temp_val&&(s.sms_type=temp_val),temp_val=e.find("#sms_display option:selected").val(),a.sms_display!=temp_val&&(s.sms_display=temp_val),temp_val=e.find("#sms_iment").val().replace(/[^0-9]/g,""),temp_val=toInteger(temp_val),toInteger(a.sms_iment)!=temp_val&&(s.sms_iment=temp_val),temp_val=e.find("#sms_amount").val().replace(/[^0-9]/g,""),a.sms_amount!=temp_val&&(s.sms_amount=temp_val),temp_val=e.find("#sms_contents").val(),a.sms_contents!=temp_val&&(s.sms_contents=temp_val),temp_val=e.find("#sms_category").attr("ci_idx"),a.sms_category!=temp_val&&(s.sms_category=temp_val),temp_val=e.find("#sms_memo").val(),a.sms_memo!=temp_val&&(s.sms_memo=temp_val),s}function set_column_values(l,n,e){var a=e.sms_date||formaterFmtDate_fromDate(),s=e.sms_time||formaterFmtTime_fromDate(),_=(l.find("#sms_date").datetimepicker({dayViewHeaderFormat:"YYYY-MM",format:"YYYY-MM-DD",locale:"ko",date:a.substring(0,4)+"-"+a.substring(4,6)+"-"+a.substring(6,8)}),l.find("#sms_time").datetimepicker({viewMode:"times",viewDate:!1,locale:"ko",widgetPositioning:{horizontal:"right"},format:"HH:mm",date:s.substring(0,2)+":"+s.substring(2,4)}),e.target_key||n.acc_key);switch(window.SBalance.request("/main/account/list",null).then(function(e){stracer("page.balance_message.html").log("/main/account/list:",e);var m=null;e.data.forEach(function(e){var a="본인",s=null,t=null;switch(e.acc_type){case"A":a="자동",s=e.acc_key,_==e.acc_key&&(t="selected");break;case"L":if("L"!=n.acc_type)return;a="공유",s=e.acc_name,n.acc_name==e.acc_name&&(t="selected");break;case"S":a="본인",s=e.acc_key,_==e.acc_key&&(t="selected");break;default:return}null!=t&&(m=!0),l.find("#acc_alias").append($(`<option class="fs_item" value="${s}" ${t||""}>[${e.acc_company}] ${e.acc_alias} (${a})</option>`))}),1!=m&&l.find("#acc_alias").append($('<option class="fs_item" value="" selected hidden>(지갑을 선택하세요.)</option>'))}),e.sms_class){case"D":case"W":l.find("#sms_class").val(e.sms_class).prop("selected",!0);break;default:l.find("#sms_class").val("(없음)")}switch(e.sms_type){case"P":case"C":case"D":case"I":l.find("#sms_type").val(e.sms_type).prop("selected",!0);break;default:l.find("#sms_type").val("(없음)")}l.find("#sms_display").val(e.sms_display||"I").prop("selected",!0),l.find("#sms_iment").val(toInteger(e.sms_iment)||""),l.find("#sms_amount").val(thousandFormatter(e.sms_amount||0)),l.find("#sms_amount").on("keyup",function(){var e=(e=$(this).val()).replace(/[^0-9]/g,"");return e=parseInt(e||0),$(this).val(thousandFormatter(e)),!1}),l.find("#sms_contents").val(e.sms_contents||""),stracer("page.balance_message.html").log("values.sms_category:",e.sms_category),0==toInteger(e.sms_category)?l.find("#sms_category").html("-"):l.find("#sms_category").html(`${e.ci_name} (${e.cg_name})`),l.find("#sms_category").attr("ci_idx",e.sms_category),l.find("#sms_category").on("click",function(){var e=l.find("#sms_category").attr("ci_idx");window.popver("https://lclasser.github.io/sbalance/pages/main/popver/select.category.html",{ci_idx:e},function(e){null!=e&&(l.find("#sms_category").attr("ci_idx",e.ci_idx),0<e.ci_idx?(l.find("#sms_category").html(`${e.ci_name} (${e.cg_name})`),n.ci_name=e.ci_name,n.cg_name=e.cg_name):l.find("#sms_category").html("-"))})}),l.find("#sms_memo").val(e.sms_memo||""),l.find("#msg_body").val(e.msg_body||"")}$(function(){var s=window.dmodal.getParam(),t=window.dmodal.getModal(),e=(stracer("page.balance_message.html").log("param:",s),null==s&&(s={is_new:!0},t.find("#modal_title").html("신규 등록")),disable_column(t,"sms_recommend"),Object.assign({},s,s.values));s.values=null,set_column_values(t,s,e),1==s.read_only?(readonly_column(t,"sms_date"),readonly_column(t,"sms_time"),disable_column(t,"acc_alias"),disable_column(t,"sms_class"),disable_column(t,"sms_type"),disable_column(t,"sms_display"),disable_column(t,"sms_iment"),readonly_column(t,"sms_amount"),disable_column(t,"sms_unit"),readonly_column(t,"sms_contents"),disable_column(t,"sms_category"),readonly_column(t,"sms_memo"),t.find("#modal_del").hide(),t.find("#modal_ok").hide(),t.find("#modal_match").hide()):"L"==s.acc_type&&(disable_column(t,"sms_date"),disable_column(t,"sms_time"),disable_column(t,"acc_alias"),disable_column(t,"sms_class"),disable_column(t,"sms_type"),disable_column(t,"sms_display"),disable_column(t,"sms_iment"),disable_column(t,"sms_amount"),disable_column(t,"sms_unit"),disable_column(t,"sms_contents"),t.find("#modal_del").attr("disabled","disabled"),t.find("#modal_match").hide()),t.find("#modal_match").click(function(){s.values=get_column_values(t,s);var e=Object.assign({},s,s.values);e.acc_key=e.target_key||e.acc_key,e.sms_category=s.values.sms_category||s.sms_category,window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.balance_match.html",e,function(e){stracer("modal.balance_item.html").log("modal.balance_match.html result:",e)})}),t.find("#modal_ok").click(function(){var e,a=get_column_values(t,s);stracer("page.balance_message.html").log("inbound:",s,a),Object.keys(a).length<=0?window.dmodal.close(null):(a.acc_key=s.acc_key,a.acc_type=s.acc_type,a.acc_name=s.acc_name,a.msg_key=s.msg_key,"L"==s.acc_type&&(a.acc_key=s.acc_name),e="/main/message/update",1==s.is_new&&(e="/main/message/insert"),window.SBalance.request(e,a).then(function(e){var a=null,s="bg-secondary",t="",t="Y"==e.error.success?(stracer("page.balance_message.html").log("message_url res:",e),0<e.data.affectedRows?(a=!0,s="bg-success","정보를 저장 했습니다."):(s="bg-secondary","저장 할 정보가 없습니다.")):(stracer("page.balance_message.html").error("message_url res:",e),s="bg-danger",`저장을 실패 했습니다. (${e.error.message})`);window.toast({title_class:s+" text-white",title_text:"상세 정보",mesg_text:t}),window.dmodal.close(a)}))}),t.find("#modal_del").click(function(){stracer("page.balance_message.html").log("modal_del...")})})</script>