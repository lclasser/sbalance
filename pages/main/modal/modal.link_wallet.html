<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role=document><div class=modal-content><div class=modal-header><h5 class=modal-title id=modal_title>지갑 공유 하기</h5><button class=btn-close type=button data-bs-dismiss=modal aria-label=Close></button></div><div class="bg-black modal-body"><div id=dlg_link_title class=overflow-hidden></div><div id=dlg_items class=overflow-hidden></div></div><div class=modal-footer><button type=button id=modal_ok class="btn btn-lg btn-primary">확인</button> <button type=button id=modal_no class="btn btn-lg btn-secondary" data-bs-dismiss=modal>취소</button></div></div></div><script>$(function(){var e=window.dmodal.getModal(),a=window.dmodal.getParam(),n=new CompSGridList(e.find("#dlg_items").get(0),{"col-height":35,"row-height":40,"row-bgcolor":function(e){return null},"row-fgcolor":function(e){return"#ffffff"},"border-color":"#000000"});n.createGrid([{id:"col_check",width:"10%",type:"callback",text:"선택",callback:function(e){return'<label style="width:100%;height:100%;"><input class="" id="sel_check" type="checkbox"></label>'},onClickCell:function(e,t){console.log("gitem.data.col_check 1:",e.data.col_check),e.data.col_check=$(e.element).parent().find("#sel_check").is(":checked"),console.log("gitem.data.col_check 2:",e.data.col_check,e.data)}},{id:"acc_company",width:"30%",type:"string",text:"금융사"},{id:"acc_alias",width:"30%",type:"string",text:"별칭"},{id:"acc_memo",width:"30%",type:"string",text:"메모"}]),Promise.resolve().then(function(){if(window.SBalance.getSignin().share_key==a.key)throw $("#modal_ok").hide(),new Error("자신을 공유 할수 없습니다.")}).then(function(){return window.SBalance.request("/main/shared/share_key",{share_key:a.key}).then(function(e){if(null==e.data||e.data.length<=0)throw new Error("공유 요청자를 찾을 수 없습니다");a.linker_name=e.data[0].usr_name,a.linker_email=e.data[0].usr_email,$("#dlg_link_title").html(`"${a.linker_name} (${a.linker_email})"님께 공유할 계좌를 선택하세요.`)})}).then(function(){return window.SBalance.request("/main/shared/account/list",{share_key:a.key}).then(function(e){console.log("res:",e),e.data.forEach(function(e,t){null==e.share_acc_name&&(e=n.insertRow(e),console.log("row_obj:",e))})})}).catch(function(e){console.log("request.catch"),window.toast({title_class:"bg-danger text-white",title_text:"지갑 공유 하기",mesg_text:e.message})}),$("#modal_ok").click(function(){var t={acc_keys:[],share_key:a.key};n.getRows().forEach(function(e){console.log("sel:",e._data),1==e._data.col_check&&t.acc_keys.push(e._data.acc_key)}),t.acc_keys.length<=0?window.toast({title_class:"bg-warning text-white",title_text:"공유 계좌 선택",mesg_text:"공유할 계좌를 선택하세요."}):window.SBalance.request("/main/shared/account/insert",t).then(function(e){window.toast({mesg_text:`"${a.linker_name} (${a.linker_email})"님과 지갑이 공유되었습니다.`,title_text:"공유 수락",title_class:"bg-secondary text-white"}),window.dmodal.close(!0)}).catch(function(e){window.toast({title_class:"bg-secondary text-white",title_text:"공유 수락",mesg_text:`공유를 실패했습니다.(${e.message})`})})})})</script>