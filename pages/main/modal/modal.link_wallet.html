<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable sb-modal" role=document><div class=modal-content><div class=modal-header><h5 class=modal-title id=modal_title>지갑 공유</h5><button class=btn-close type=button data-bs-dismiss=modal aria-label=Close></button></div><div class="modal-body sb-form"><div class=sb-row><div id=dlg_link_title class=overflow-hidden></div></div><div class=sb-row><div id=obj_body class="overflow-hidden w-100"></div></div></div><div class=modal-footer><button type=button id=modal_ok class="btn btn-lg btn-primary">확인</button> <button type=button id=modal_no class="btn btn-lg btn-secondary" data-bs-dismiss=modal>취소</button></div></div></div><script>$(function(){var e=window.dmodal.getModal(),t=window.dmodal.getParam(),c=(console.log("link_wallet"),`<div class="row sel_row m-0" style="min-height:54px;" acc_key="">
        <div class="col-auto d-flex align-items-center p-1">
            <label class="sb-check align-items-center" style="height:36px;">
                <input class="sel_check" type="checkbox">
            </label>
        </div>

        <div class="col-3 d-flex align-items-center p-1" id="acc_company">금융사</div>
        <div class="col d-flex flex-column justify-content-center">
            <div class="row text-truncate" id="acc_alias">별칭</div>
            <div class="row text-truncate memo-text" id="acc_memo">메모</div>
        </div>
        <div class="col-auto d-flex align-items-center p-0" id="acc_perm">
            <button class="btn cancel-btn sel_perm me-1" type="button">읽기</button>
        </div>
    </div>`),n=e.find("#obj_body"),a=$(c);a.find("#acc_memo").hide(),a.click(function(e){var t=$(e.target),a=!$(this).find(".sel_check").is(":checked");switch((t.prop("type")||"").toLowerCase()){case"button":var c=n.find(".sel_perm:not(:disabled)");return void(t.hasClass("cancel-btn")?(c.removeClass("cancel-btn").addClass("update-btn"),c.html("수정")):(c.removeClass("update-btn").addClass("cancel-btn"),c.html("읽기")));case"checkbox":a=$(e.target).is(":checked");default:n.find(".sel_check:not(:disabled)").prop("checked",a)}}),n.append(a),Promise.resolve().then(function(){return window.SBalance.request("/main/shared/share_key",{share_key:t.key}).then(function(e){if(null==e.data||e.data.length<=0)throw new Error("공유 요청자를 찾을 수 없습니다");t.linker_name=e.data[0].usr_name,t.linker_email=e.data[0].usr_email,$("#dlg_link_title").html(`"${t.linker_name} (${t.linker_email})"님께 공유할 지갑을 선택하세요.`)})}).then(function(){return window.SBalance.request("/main/shared/account/list",{share_key:t.key}).then(function(e){stracer("modal.link_wallet.html").log("res:",e),e.data.forEach(function(e,t){var a=$(c);a.find("#acc_company").html(e.acc_company),a.find("#acc_alias").html(e.acc_alias),a.find("#acc_memo").html(e.acc_memo),"L"==e.shared?(a.addClass("read-text"),a.find(".sel_check").attr("disabled","disabled"),a.find(".sel_perm").attr("disabled","disabled")):(a.attr("acc_key",e.acc_key),a.click(function(e){var t=$(e.target);switch((t.prop("type")||"").toLowerCase()){case"checkbox":return;case"button":return void(t.hasClass("cancel-btn")?(t.removeClass("cancel-btn").addClass("update-btn"),t.html("수정")):(t.removeClass("update-btn").addClass("cancel-btn"),t.html("읽기")));default:var a=$(this).find(".sel_check");a.prop("checked",!a.is(":checked"))}})),n.append($('<div class="sb-seperater m-0 w-100"/>')),n.append(a)})})}).catch(function(e){stracer("modal.link_wallet.html").log("request.catch"),window.toast({title_class:"bg-danger text-white",title_text:"지갑 공유 하기",mesg_text:e.message})}),e.find("#modal_ok").click(function(){var l={share_wlt:[],share_key:t.key};n.find(".sel_row").each(function(e,t){var a=$(t).find(".sel_check"),c=$(t).find(".sel_perm"),t=$(t).attr("acc_key"),c=getPermissionValue(c.html());null==t||t.length<=0||1==a.is(":checked")&&l.share_wlt.push({acc_key:t,acc_perm:c})}),l.share_wlt.length<=0?window.toast({title_class:"bg-warning text-white",title_text:"공유 지갑 선택",mesg_text:"공유할 지갑을 선택하세요."}):window.SBalance.request("/main/shared/account/insert",l).then(function(e){window.toast({mesg_text:`"${t.linker_name} (${t.linker_email})"님과 지갑이 공유되었습니다.`,title_text:"공유 수락",title_class:"bg-secondary text-white"}),window.dmodal.close(!0)}).catch(function(e){window.toast({title_class:"bg-secondary text-white",title_text:"공유 수락",mesg_text:`공유를 실패했습니다.(${e.message})`})})})})</script>