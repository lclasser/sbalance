<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable sb-modal" role=document><div class=modal-content><div class=modal-header><h5 class=modal-title id=modal_title>분류 추가</h5><button class=btn-close type=button data-bs-dismiss=modal aria-label=Close></button></div><div class="modal-body sb-form"><div class=sb-row><div class=sb-col><label class="sb-label w-4">그룹</label> <select class=sb-select id=dlg_cgroup></select></div></div><div class=sb-row><div class=sb-col><label class="sb-label w-4">이름</label> <input class=sb-input type=text placeholder="분류 이름" id=dlg_alias></div></div><div class=sb-row><div class=sb-col><label class="sb-label w-4">종류</label> <select class=sb-select id=dlg_catetype><option value=N>일반<option value=T>이체 계좌<option value=E>예외 (일별만 표시)</select></div></div><div class=sb-row><div class=sb-col><label class="sb-label w-4">순서</label> <input class=sb-input type=text placeholder="분류 순서" id=dlg_sort></div></div><div class=sb-row><div class=sb-col><label class="sb-label w-4">예산</label> <input class=sb-input type=text placeholder="예산 금액" id=dlg_budget></div></div></div><div class=modal-footer><button type=button id=modal_del class="btn btn-lg btn-danger me-auto">삭제</button> <button type=button id=modal_ok class="btn btn-lg btn-primary">저장</button> <button type=button class="btn btn-lg btn-secondary" data-bs-dismiss=modal>취소</button></div></div></div><script>$(function(){var i,a=window.dmodal.getModal(),t=window.dmodal.getParam();stracer("modal.setup_citem.html").log("param:",t);Promise.resolve().then(function(){return null==t.ci_idx?window.SBalance.request("/main/category/group/select",{cg_key:t.cg_key}):window.SBalance.request("/main/category/item/select",{cg_key:t.cg_key,ci_idx:t.ci_idx})}).then(function(e){switch(i=e&&e.data&&e.data[0],t.ci_idx,window.SBalance.request("/main/category/group/list").then(function(e){"L"==i.cg_type?e.data.some(function(e){if(t.cg_key==e.cg_key)return a.find("#dlg_cgroup").append($(`<option class="fs_item" value="${e.cg_key}" selected> ${e.disp_alias} (${e.usr_email})</option>`)),!0}):e.data.forEach(function(e){var d;"L"!=e.cg_type&&(d=t.cg_key==e.cg_key?"selected":"",a.find("#dlg_cgroup").append($(`<option class="fs_item" value="${e.cg_key}" ${d}> ${e.disp_alias}</option>`)))})}),"L"==i.cg_type&&(a.find("#dlg_cgroup").attr("disabled","disabled"),a.find("#dlg_cgroup").parent().attr("disabled","disabled"),i.cg_perm!==Permission.READ_WRITE)&&(a.find("#dlg_cgroup").attr("disabled","disabled"),a.find("#dlg_alias").attr("disabled","disabled"),a.find("#dlg_catetype").attr("disabled","disabled"),a.find("#dlg_sort").attr("disabled","disabled"),a.find("#dlg_budget").attr("disabled","disabled"),a.find("#modal_del").hide(),a.find("#modal_ok").hide()),a.find("#dlg_sort").val(i.ci_sort||100),i.ci_type){case"N":case"T":case"E":a.find("#dlg_catetype").val(i.ci_type).prop("selected",!0);break;default:a.find("#dlg_catetype").val("N").prop("selected",!0)}a.find("#dlg_alias").val(i.ci_name||""),a.find("#dlg_budget").val(toNumber(i.ci_budget)),a.find("#modal_del").click(function(){window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.confirm.html",{title:"삭제 확인",content:`"${a.find("#dlg_alias").val()}" 분류를 삭제 하시겠습니까?`,btn_confirm:"삭제",btn_cancel:"취소"},function(e){1==e&&(window.SBalance.request("/main/category/item/delete",{cg_key:i.cg_key,cg_type:i.cg_type,ci_idx:i.ci_idx}).then(function(e){e.error.success}),window.dmodal.exit(!0))})}),a.find("#modal_ok").click(function(){var e=a.find("#dlg_cgroup option:selected").val(),d=(e==i.cg_key&&(e=null),a.find("#dlg_sort").val()),d=((null==d||d.length<=0)&&(d=100),{cg_key:i.cg_key,cg_type:i.cg_type,ci_idx:i.ci_idx,ci_name:a.find("#dlg_alias").val(),ci_type:a.find("#dlg_catetype option:selected").val(),ci_budget:toInteger(a.find("#dlg_budget").val()),ci_sort:toInteger(d),target_cg_key:e}),t=(stracer("modal.setup_citem.html").log("category update:",d),"/main/category/item/update");null==d.ci_idx&&(t="/main/category/item/insert"),window.SBalance.request(t,d).then(function(e){null!=e&&(stracer("modal.setup_citem.html").log(t+" res:",e),"Y"==e.error.success)?window.dmodal.close(!0):window.dmodal.close()})})}),"수정"===t.btn_confirm?(a.find("#modal_ok").html(t.btn_confirm),a.find("#modal_del").show()):a.find("#modal_del").hide(),a.find("#modal_title").html(t.title),eventInputNumber(a.find("#dlg_sort")[0]),eventInputNumber(a.find("#dlg_budget")[0])})</script>