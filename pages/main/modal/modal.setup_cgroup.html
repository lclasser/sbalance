<style>#dlg_sharing .seperater{margin:5px!important;border-top:1px dashed #717171;height:3px;width:100%}</style><div class="modal-dialog modal-dialog-centered modal-dialog-scrollable sb-modal" role=document><div class=modal-content><div class=modal-header><h5 class=modal-title id=modal_title>그룹 추가</h5><button class=btn-close type=button data-bs-dismiss=modal aria-label=Close></button></div><div class=modal-body><div class=input-row><div class=input-col><label class="col-2 input-label">이름</label> <input class="form-control input-value" type=text placeholder="그룹 이름" id=dlg_name></div></div><div class=input-row><div class=input-col><label class="col-2 input-label">순서</label> <input class="form-control input-value" type=text placeholder="그룹 순서" id=dlg_sort></div></div><div class=input-row style=display:none><div class=input-col><label class="col-2 input-label">공유자</label> <label class="form-control input-value" id=dlg_sharer></label></div></div><div class="input-row h-100" style=display:none><div class=input-col><label class="col-2 input-label">공유</label><div class="form-control input-value d-flex m-0 row" id=dlg_sharing></div></div></div></div><div class=modal-footer><button type=button id=modal_del class="btn btn-lg btn-danger me-auto">삭제</button> <button type=button id=modal_ok class="btn btn-lg btn-primary">저장</button> <button type=button class="btn btn-lg btn-secondary" data-bs-dismiss=modal>취소</button></div></div></div><script>$(function(){var l=window.dmodal.getModal(),o=window.dmodal.getParam();console.log("modal.category_group param:",o),eventInputNumber(l.find("#dlg_sort")[0]),null==o?(l.find("#modal_ok").html("추가"),l.find("#modal_del").hide()):(o.title&&l.find("#modal_title").html(o.title),o.cg_name&&l.find("#dlg_name").val(o.cg_name),o.cg_sort&&l.find("#dlg_sort").val(o.cg_sort),"L"==o.cg_type?(l.find("#modal_ok").hide(),l.find("#modal_del").html("해제"),l.find("#dlg_name").attr("readonly","readonly"),l.find("#dlg_sort").attr("readonly","readonly"),window.SBalance.request("/main/category/group/owner",{cg_key:o.cg_key}).then(function(e){e=e.data[0];null!=e?l.find("#dlg_sharer").html(`${e.usr_name} (${e.usr_email})`):l.find("#dlg_sharer").html("공유가 해제되었습니다."),l.find("#dlg_sharer").parent().parent().show()})):(l.find("#modal_del").show(),l.find("#modal_ok").html("수정"),function t(){var n=l.find("#dlg_sharing");window.SBalance.request("/main/category/group/linking",{cg_key:o.cg_key}).then(function(e){n.empty(),e.data.forEach(function(e){0<n.children().length&&n.append($('<div class="seperater"/>')),n.append('<div class="row align-items-center m-0 p-0"><div class="col m-0  p-0">'+`<div class="text-break" id="link_user">${e.usr_name}</div>`+`<div class="text-break" id="link_email">(${e.usr_email})</div>`+'</div><div class="col-auto m-0 p-0"><button class="btn btn-primary share_key p-1" type="button">해제</button>'+`<input type="hidden" id="share_key" value="${e.share_key}">`+"</div></div>")}),0<e.data.length?n.find(".share_key").click(function(){var n=$(this).parent().parent().find("#share_key").val(),e=$(this).parent().parent().find("#link_user").html(),a=$(this).parent().parent().find("#link_email").html();window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.confirm.html",{title:"공유 해제 확인",content:`"${e} (${a})" 와 분류 공유를 해제 하시겠습니까?`,btn_confirm:"해제",btn_cancel:"취소"},function(e){1==e&&window.SBalance.request("/main/shared/group/release",{share_key:n,cg_key:o.cg_key}).then(function(e){null!=e.error&&"Y"!=e.error.success?window.toast({title_class:"bg-danger text-white",title_text:l.find("#modal_title").text(),mesg_text:`공유 해제를 실패 했습니다. (${e.error.message})`}):t()})})}):n.html("공유한 사용자가 없습니다."),n.parent().parent().show()})}())),$("#modal_del").click(function(){window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.confirm.html",{title:l.find("#modal_del").html()+" 확인",content:`"${o.cg_name}" 그룹을 ${l.find("#modal_del").html()} 하시겠습니까?`,btn_confirm:l.find("#modal_del").html(),btn_cancel:"취소"},function(e){1==e&&(e={cg_key:o.cg_key},window.SBalance.request("/main/category/group/delete",e).then(function(e){console.log("/main/category/item/update res:",e),e.error.success}),window.dmodal.exit(!0))})}),$("#modal_ok").click(function(){var e={cg_key:o&&o.cg_key,cg_name:$("#dlg_name").val(),cg_sort:$("#dlg_sort").val()},n=null==e.cg_key?"/main/category/group/insert":"/main/category/group/update";window.SBalance.request(n,e).then(function(e){console.log(n+" res:",e),"Y"==e.error.success?window.dmodal.close(!0):window.dmodal.close()})})})</script>