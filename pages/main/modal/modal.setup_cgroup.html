<style>#dlg_sharing .seperater{margin:5px!important;border-top:1px dashed #717171;height:3px;width:100%}</style><div class="modal-dialog modal-dialog-centered modal-dialog-scrollable sb-modal" role=document><div class=modal-content><div class=modal-header><h5 class=modal-title id=modal_title>그룹 추가</h5><button class=btn-close type=button data-bs-dismiss=modal aria-label=Close></button></div><div class="modal-body sb-form"><div class=sb-row><div class=sb-col><label class="sb-label w-4">이름</label> <input class=sb-input type=text placeholder="그룹 이름" id=dlg_alias></div></div><div class=sb-row><div class=sb-col><label class="sb-label w-4">순서</label> <input class=sb-input type=text placeholder="그룹 순서" id=dlg_sort></div></div><div class=sb-row style=display:none><div class=sb-col><label class="sb-label w-4">공유자</label> <label class=sb-input id=dlg_sharer></label></div></div><div class="sb-row h-100" style=display:none><div class=sb-col><label class="sb-label w-4">공유</label><div class="sb-input d-flex m-0 pe-1 row" id=dlg_sharing></div></div></div></div><div class=modal-footer><button type=button id=modal_del class="btn btn-lg delete-btn me-auto">삭제</button> <button type=button id=modal_ok class="btn btn-lg insert-btn">저장</button> <button type=button class="btn btn-lg cancel-btn" data-bs-dismiss=modal>취소</button></div></div></div><script>$(function(){var l=window.dmodal.getModal(),i=window.dmodal.getParam();stracer("modal.setup_cgroup.html").log("param:",i),eventInputNumber(l.find("#dlg_sort")[0]),null==i?(l.find("#modal_ok").html("추가"),l.find("#modal_del").hide()):(i.title&&l.find("#modal_title").html(i.title),window.SBalance.request("/main/category/group/select",{cg_key:i.cg_key}).then(function(e){var n;null==(gitem=e&&e.data&&e.data[0])?window.toast({title_class:"bg-danger text-white",title_text:l.find("#modal_title").text(),mesg_text:`유효하지 않는 카테고리입니다. (${e.error.message})`}):(gitem.cg_alias=gitem.cg_alias||gitem.grp_alias,l.find("#dlg_alias").val(gitem.cg_alias),gitem.cg_sort&&l.find("#dlg_sort").val(gitem.cg_sort),"L"==gitem.cg_type?(l.find("#modal_del").html("해제"),l.find("#modal_ok").html("수정"),null!=gitem.usr_name?l.find("#dlg_sharer").html(`${gitem.usr_name} (${gitem.usr_email})`):l.find("#dlg_sharer").html("공유가 해제되었습니다."),l.find("#dlg_sharer").parent().parent().show()):(l.find("#modal_del").show(),l.find("#modal_ok").html("수정"),n=l.find("#dlg_sharing"),window.SBalance.request("/main/category/group/linking",{cg_key:i.cg_key}).then(function(e){n.empty(),e.data.forEach(function(e){0<n.children().length&&n.append($('<div class="seperater"/>'));var t="cancel-btn",a="읽기";e.cg_perm===Permission.READ_WRITE&&(t="udpate-btn",a="수정"),n.append(`<div class="row align-items-center m-0 p-0" permission="${e.cg_perm}" share_key="${e.share_key}">`+'<div class="col m-0 p-0">'+`<div class="text-break" id="link_user">${e.usr_name}</div>`+`<div class="text-break memo-text" id="link_email">(${e.usr_email})</div>`+"</div>"+`<div class="col-auto m-0 p-0 pe-1"><button class="btn ${t} p-1" type="button">${a}</button></div>`+'<div class="col-auto m-0 p-0"><button class="btn shared-btn p-1" type="button">해제</button></div></div>')}),0<e.data.length?(n.find(".update-btn").click(function(){console.log("update-btn")}),n.find(".cancel-btn").click(function(){console.log("cancel-btn")}),n.find(".shared-btn").click(function(){var t=$(this).parent().parent().attr("share_key"),e=$(this).parent().parent().find("#link_user").html(),a=$(this).parent().parent().find("#link_email").html();window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.confirm.html",{title:"공유 해제 확인",content:`"${e} ${a}" 와 분류 공유를 해제 하시겠습니까?`,btn_confirm:"해제",btn_cancel:"취소"},function(e){1==e&&window.SBalance.request("/main/shared/category/release",{share_key:t,cg_key:i.cg_key}).then(function(e){null!=e.error&&"Y"!=e.error.success?window.toast({title_class:"bg-danger text-white",title_text:l.find("#modal_title").text(),mesg_text:`공유 해제를 실패 했습니다. (${e.error.message})`}):requestLinking()})})})):n.html("공유한 사용자가 없습니다."),n.parent().parent().show()})))})),l.find("#modal_del").click(function(){window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.confirm.html",{title:l.find("#modal_del").html()+" 확인",content:`"${l.find("#dlg_alias").val()}" 그룹을 ${l.find("#modal_del").html()} 하시겠습니까?`,btn_confirm:l.find("#modal_del").html(),btn_cancel:"취소"},function(e){if(1==e)return window.SBalance.request("/main/category/group/delete",{cg_key:i.cg_key}).then(function(e){stracer("modal.setup_cgroup.html").log("/main/category/item/delete res:",e),e.error.success,window.dmodal.exit(!0)})})}),l.find("#modal_ok").click(function(){var e={cg_key:i&&i.cg_key,cg_alias:$("#dlg_alias").val(),cg_sort:$("#dlg_sort").val()},t=null==e.cg_key?"/main/category/group/insert":"/main/category/group/update";window.SBalance.request(t,e).then(function(e){stracer("modal.setup_cgroup.html").log(t+" res:",e),"Y"==e.error.success?window.dmodal.close(!0):window.dmodal.close()})})})</script>