<style>#dlg_sharing .seperater{--margin:5px!important;border-top:1px dashed #717171;height:3px;width:100%}</style><div class="modal-dialog modal-dialog-centered modal-dialog-scrollable sb-modal" role=document><div class=modal-content><div class=modal-header><h5 class=modal-title id=modal_title>그룹 추가</h5><button class=btn-close type=button data-bs-dismiss=modal aria-label=Close></button></div><div class="modal-body sb-form"><div class=sb-row><div class=sb-col><label class="sb-label w-3">이름</label> <input class=sb-input type=text placeholder="그룹 이름" id=dlg_alias></div></div><div class=sb-row><div class=sb-col><label class="sb-label w-3">순서</label> <input class=sb-input type=text placeholder="그룹 순서" id=dlg_sort></div></div><div class=sb-row style=display:none><div class=sb-col><label class="sb-label w-3">공유자</label> <label class=sb-input id=dlg_sharer></label></div></div><div class="sb-row h-100" style=display:none><div class=sb-col><label class="sb-label w-3">공유</label><div class="sb-input d-flex m-0 p-0 row" id=dlg_sharing></div></div></div></div><div class=modal-footer><button type=button id=modal_del class="btn btn-lg delete-btn me-auto">삭제</button> <button type=button id=modal_ok class="btn btn-lg insert-btn">저장</button> <button type=button class="btn btn-lg cancel-btn" data-bs-dismiss=modal>취소</button></div></div></div><script>$(function(){var r=window.dmodal.getModal(),a=window.dmodal.getParam();stracer("modal.setup_cgroup.html").log("param:",a),eventInputNumber(r.find("#dlg_sort")[0]),null==a?(r.find("#modal_ok").html("추가"),r.find("#modal_del").hide()):(a.title&&r.find("#modal_title").html(a.title),window.SBalance.request("/main/category/group/select",{cg_key:a.cg_key}).then(function(t){null==(gitem=t&&t.data&&t.data[0])?window.toast({title_class:"bg-danger text-white",title_text:r.find("#modal_title").text(),mesg_text:`유효하지 않는 카테고리입니다. (${t.error.message})`}):(gitem.cg_alias=gitem.cg_alias||gitem.grp_alias,r.find("#dlg_alias").val(gitem.cg_alias),gitem.cg_sort&&r.find("#dlg_sort").val(gitem.cg_sort),"L"==gitem.cg_type?(r.find("#modal_del").html("해제"),r.find("#modal_ok").html("수정"),null!=gitem.usr_name?r.find("#dlg_sharer").html(`${gitem.usr_name} (${gitem.usr_email})`):r.find("#dlg_sharer").html("공유가 해제되었습니다."),r.find("#dlg_sharer").parent().parent().show()):(r.find("#modal_del").show(),r.find("#modal_ok").html("수정"),function l(i){var n=r.find("#dlg_sharing");window.SBalance.request("/main/category/group/linking",{cg_key:i}).then(function(t){n.empty(),t.data.forEach(function(t){0<n.children().length&&n.append($('<div class="seperater"/>'));var e="cancel-btn",a="읽기";t.cg_perm===Permission.READ_WRITE&&(e="update-btn",a="수정"),n.append(`<div class="d-flex align-items-center m-0 p-1" share_key="${t.share_key}">`+'<div class="col p-1">'+`<div class="text-break" id="link_user">${t.usr_name}</div>`+`<div class="text-break memo-text" id="link_email">(${t.usr_email})</div>`+'</div><div class="col-auto share_func">'+`<button class="btn ${e} me-1" type="button">${a}</button>`+'<button class="btn shared-btn share_key" type="button">해제</button></div></div>')}),0<t.data.length?(n.find(".share_func button.cancel-btn, button.update-btn").click(function(){var t=$(this).parent().parent().find("#link_user").html(),e=$(this).parent().parent().find("#link_email").html(),a=$(this).parent().parent().attr("share_key"),n=(console.log("cancel-btn:",t,e,a),console.log("has:",$(this).hasClass("cancel-btn"),$(this).hasClass("update-btn")),{share_key:a,cg_key:i,cg_perm:Permission.READ_WRITE});1==$(this).hasClass("update-btn")&&(n.cg_perm=Permission.READ_ONLY),window.SBalance.request("/main/shared/category/permit",n).then(function(t){null!=t.error&&"Y"!=t.error.success?window.toast({title_class:"bg-danger text-white",title_text:r.find("#modal_title").text(),mesg_text:`권한 변경을 실패 했습니다. (${t.error.message})`}):l(i),stracer("modal.setup_cgroup.html").log(n,t)})}),n.find(".share_func button.shared-btn").click(function(){var a=$(this).parent().parent().attr("share_key"),t=$(this).parent().parent().find("#link_user").html(),e=$(this).parent().parent().find("#link_email").html();window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.confirm.html",{title:"공유 해제 확인",content:`"${t} ${e}" 와 분류 공유를 해제 하시겠습니까?`,btn_confirm:"해제",btn_cancel:"취소"},function(t,e){if(1==e)return window.SBalance.request("/main/shared/category/release",{share_key:a,cg_key:i}).then(function(t){null!=t.error&&"Y"!=t.error.success?window.toast({title_class:"bg-danger text-white",title_text:r.find("#modal_title").text(),mesg_text:`공유 해제를 실패 했습니다. (${t.error.message})`}):l(i)})})})):n.html("공유한 사용자가 없습니다."),n.parent().parent().show()})}(a.cg_key)))})),r.find("#modal_del").click(function(){window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.confirm.html",{title:r.find("#modal_del").html()+" 확인",content:`"${r.find("#dlg_alias").val()}" 그룹을 ${r.find("#modal_del").html()} 하시겠습니까?`,btn_confirm:r.find("#modal_del").html(),btn_cancel:"취소"},function(t,e){if(1==e)return window.SBalance.request("/main/category/group/delete",{cg_key:a.cg_key}).then(function(t){stracer("modal.setup_cgroup.html").log("/main/category/item/delete res:",t),window.dmodal.exit(!0)})})}),r.find("#modal_ok").click(function(){var t={cg_key:a&&a.cg_key,cg_alias:$("#dlg_alias").val(),cg_sort:$("#dlg_sort").val()},e=null==t.cg_key?"/main/category/group/insert":"/main/category/group/update";window.SBalance.request(e,t).then(function(t){stracer("modal.setup_cgroup.html").log(e+" res:",t),"Y"==t.error.success?window.dmodal.close(!0):window.dmodal.close()})})})</script>