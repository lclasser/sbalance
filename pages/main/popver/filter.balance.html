<style>.list-group-item.focus:not(:hover){color:#e9e6e6;background-color:#555}.item-flex-center{display:flex;align-items:center;width:100%;height:100%}</style><page class="d-block h-100 p-0 pb-2 pt-2 w-80" style=position:fixed;margin:auto;left:0;right:0;top:0;width:80%;display:none onopen=onOpened(this) onload=onLoaded(this) onclose=onClosed(this)><div id=dialog_modal class="align-items-center d-flex fade justify-content-center modal position-relative show" tabindex=-1 role=dialog data-bs-focus=false data-bs-backdrop=static aria-labelledby=dialog_modal aria-hidden=true><div class="m-0 modal-dialog modal-dialog-scrollable sb-modal" role=document style=min-width:100%><div class=modal-content><div class=modal-header><h5 class=modal-title id=modal_title>필터 선택</h5><button class=btn-close type=button data-bs-dismiss=modal aria-label=Close></button></div><div class="modal-body overflow-auto"><div id=_head><ul class="nav nav-tabs" id=tab_list role=tablist><li class=nav-item role=presentation><button class=nav-link id=tab_wallet data-bs-toggle=tab data-bs-target=#wallet type=button role=tab aria-controls=wallet aria-selected=true>지갑</button><li class=nav-item role=presentation><button class=nav-link id=tab_category data-bs-toggle=tab data-bs-target=#category type=button role=tab aria-controls=category aria-selected=false>분류</button><li class=nav-item role=presentation><button class=nav-link id=tab_instment data-bs-toggle=tab data-bs-target=#instment type=button role=tab aria-controls=instment aria-selected=false>할부</button></ul></div><div id=tab_body><div id=list_wallet style=display:none></div><div id=list_category style=display:none></div><div id=list_instment style=display:none></div></div></div><div class=modal-footer><button type=button id=modal_clear class="btn btn-lg btn-warning me-auto">초기화</button> <button type=button id=modal_ok class="btn btn-lg btn-primary">적용</button> <button type=button class="btn btn-lg btn-secondary" data-bs-dismiss=modal>취소</button></div></div></div></div></page><script>function onOpened(t){stracer("filter.balance.html").log("dpopver:",t);var e=t.getParam(),c=window.SBalance.getReference("filters",{now_date:new Date});function a(e,t){var t="pvgroup_"+(t||0),c=$("<div/>").addClass("sb-card card border w-100 mb-1").html(`
    <div class="card-header d-flex align-items-center p-1" style="height:35px;">
        <label class="sb-check d-flex flex-fill align-items-center h-100">
            <input class="" type="checkbox" id="item_check">
            <span class="item-flex-center ps-2" for="" id="item_title"></span>
        </label>
        <div class="ms-1 ps-4">
            <button type="button" class="transparent-bgcolor"
                data-bs-toggle="collapse" data-bs-target=".group_x" aria-expanded="false" aria-controls=".group_x">
                <div class="collapse hide group_x"><img style="height:24px;" src="https://lclasser.github.io/sbalance/public/image/card_down.svg"></div>
                <div class="collapse show group_x"><img style="height:24px;" src="https://lclasser.github.io/sbalance/public/image/card_up.svg"></div>
            </button>
        </div>
    </div>
    <div class="card-body p-0">
        <ul class="list-group list-group-flush collapse show group_x"></ul>
    </div>
    </ul>`);return c.find("#item_check").attr("id",t),c.find("#item_title").html(e),c.find("#item_title").attr("for",t),c.find(".group_x").removeClass("group_x").addClass(t),c.find('[data-bs-target=".group_x"]').attr("data-bs-target","."+t),c.find('[aria-controls=".group_x"]').attr("aria-controls",t),c.find("#"+t).click(function(){var e=$(this).prop("checked");c.find('[type="checkbox"]').prop("checked",e)}),c._grp_index=t,c}function n(e,t,c,a,i){c=$(`
        <li class="list-group-item list-group-item-action p-1" ikey="${t}">
            <label class="sb-check item-flex-center" style="height:36px;">
                <input class="" type="checkbox" value="${c}" id="${t}">
                <span class="text-truncate ps-2" for="${t}">
                    ${a} ${null!=i?"("+i+")":""}
                </span>
            </label>
        </li>`);return e.find(".list-group").append(c),c}var l={tab_wallet:t.find("#list_wallet"),tab_category:t.find("#list_category"),tab_instment:t.find("#list_instment")},o={acc_keys:null,ci_idxs:null,is_iment:null,iment_look:null};function d(e){var t=e.parents(".sb-card");(t=null==t||t.length<=0?e:t).find(".card-body").find('[type="checkbox"]:checked').length!=t.find(".card-body").find('[type="checkbox"]').length?t.find(".card-header").find('[type="checkbox"]').prop("checked",!1):t.find(".card-header").find('[type="checkbox"]').prop("checked",!0)}null!=e&&(e.acc_key&&e.acc_key.forEach(function(e){o.acc_keys=o.acc_keys||{},o.acc_keys[e]=!0}),null!=e.ci_idx&&0<e.ci_idx.length&&(o.ci_idxs=o.ci_idxs||{},e.ci_idx.forEach(function(e){o.ci_idxs[e]=!0}),o.ci_idxs[0]=o.ci_idxs[0]||!1),o.is_iment=e.is_iment,o.iment_look=e.iment_look);var i,s={mark:a("할부 표시",1),look:a("할부 보기",2)};if(null!=s.mark&&(s.mark.find("input[type=checkbox]").attr("disabled","disabled"),n(s.mark,"instment_1","S","결제 기준"),n(s.mark,"instment_2","U","할부 기준"),l.tab_instment.append(s.mark),(i=s.mark.find(".card-body").find('[type="checkbox"]')).click(function(){var c=$(this);i.each(function(e,t){$(t).attr("id")!=c.attr("id")&&$(t).prop("checked","")})}),(0==o.is_iment?s.mark.find("#instment_1"):s.mark.find("#instment_2")).prop("checked",!0)),null!=s.look){s.look.find("input[type=checkbox]").attr("disabled","disabled"),n(s.look,"instment_3","X","할부만 제외"),n(s.look,"instment_4","O","할부만 표시"),l.tab_instment.append(s.look);var r=s.look.find(".card-body").find('[type="checkbox"]');switch(r.click(function(){var c=$(this);r.each(function(e,t){$(t).attr("id")!=c.attr("id")&&$(t).prop("checked","")})}),o.iment_look){case"X":s.look.find("#instment_3").prop("checked",!0);break;case"O":s.look.find("#instment_4").prop("checked",!0)}}var e=window.SBalance.request("/main/account/list").then(function(e){stracer("filter.balance.html").log("/main/account/list:",e);var i={self:a("본인",1),link:a("공유",2)};e.data.forEach(function(e,t){var c=null,a=null;switch(e.acc_type){case"A":case"S":a=i.self;break;case"L":a=i.link}null!=a&&(c=n(a,"wallet_"+t,e.acc_key,e.acc_alias,e.acc_company),a._count=i.self._count||0,a._count++,null!=o.acc_keys&&1!=o.acc_keys[e.acc_key]||c.find('[type="checkbox"]').prop("checked",!0))}),d(i.self),d(i.link),0<i.self._count&&l.tab_wallet.append(i.self),0<i.link._count&&l.tab_wallet.append(i.link)}),p=window.SBalance.request("/main/category/item/list").then(function(e){stracer("filter.balance.html").log("/main/category/list:",e);var c={},t=(c[""]=a("미분류",0),l.tab_category.prepend(c[""]),n(c[""],"category_0",0,"미분류"));!t||null!=o.ci_idxs&&1!=o.ci_idxs[0]||t.find('[type="checkbox"]').prop("checked",!0),e.data.forEach(function(e,t){null==c[e.cg_key]&&(c[e.cg_key]=a(e.cg_alias||e.grp_alias,t+1),l.tab_category.append(c[e.cg_key]));t=n(c[e.cg_key],"category_"+(t+1),e.ci_idx,e.ci_name);!t||null!=o.ci_idxs&&1!=o.ci_idxs[e.ci_idx]||t.find('[type="checkbox"]').prop("checked",!0)}),Object.values(c).forEach(function(e){d(e)})});Promise.all([e,p]).then(function(){stracer("filter.balance.html").log("/query finish"),t.$body.css("disply","block"),t.find('button[data-bs-toggle="tab"]').on("shown.bs.tab",function(e){stracer("filter.balance.html").log("event:",e),Object.values(l).forEach(function(e){e.hide()}),c.last_tab_id=e.target.id,l[c.last_tab_id].show()}),c.last_tab_id=c.last_tab_id||(t.find('button[data-bs-toggle="tab"].active')[0]||t.find("#tab_wallet")[0]||{}).id,l[c.last_tab_id].show(),t.find("button#"+c.last_tab_id).addClass("active")}).then(function(){t.find('.card-body [type="checkbox"]').click(function(){d($(this))})}),t.find("#modal_clear").click(function(){t.find('[type="checkbox"]').prop("checked",!0),s.mark.find('[type="checkbox"]').prop("checked",!1),s.look.find('[type="checkbox"]').prop("checked",!1),s.mark.find("#instment_2").prop("checked",!0)}),t.find("#modal_ok").click(function(){var c={acc_key:[],ci_idx:[],iment_look:null},e=l.tab_wallet.find(".card-body [type=checkbox]"),e=(l.tab_wallet.find(".card-body [type=checkbox]:checked").each(function(e,t){c.acc_key.push(t.value)}),e.length<=c.acc_key.length&&delete c.acc_key,l.tab_category.find(".card-body [type=checkbox]"));l.tab_category.find(".card-body [type=checkbox]:checked").each(function(e,t){c.ci_idx.push(t.value)}),e.length<=c.ci_idx.length&&delete c.ci_idx,s.mark.find(".card-body").find('[type="checkbox"]:checked').each(function(e,t){"S"===t.value?c.is_iment=!1:delete c.is_iment}),s.look.find(".card-body").find('[type="checkbox"]:checked').each(function(e,t){c.iment_look=t.value}),(null==c.iment_look||c.iment_look.length<=0)&&delete c.iment_look,stracer("filter.balance.html").log("result:",c),t.close(c)})}function onLoaded(e){stracer("filter.balance.html").log("onLoaded:",e)}function onClosed(e){stracer("filter.balance.html").log("onClosed:",e)}</script>