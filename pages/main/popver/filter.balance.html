<style>.list-group-item.focus:not(:hover){color:#e9e6e6;background-color:#555}.item-flex-center{display:flex;align-items:center;width:100%;height:100%}</style><page class="d-block h-100 p-0 pb-2 pt-2 w-80" style=position:fixed;margin:auto;left:0;right:0;top:0;width:80%;display:none onopen=onOpened(this) onload=onLoaded(this) onclose=onClosed(this)><div id=dialog_modal class="align-items-center d-flex fade justify-content-center modal position-relative show" tabindex=-1 role=dialog data-bs-focus=false data-bs-backdrop=static aria-labelledby=dialog_modal aria-hidden=true><div class="m-0 modal-dialog modal-dialog-scrollable sb-modal" role=document style=min-width:100%><div class=modal-content><div class=modal-header><h5 class=modal-title id=modal_title>필터 선택</h5><button class=btn-close type=button data-bs-dismiss=modal aria-label=Close></button></div><div class="modal-body overflow-auto"><div id=_head><ul class="nav nav-tabs" id=tab_list role=tablist><li class=nav-item role=presentation><button class="nav-link active" id=tab_wallet data-bs-toggle=tab data-bs-target=#wallet type=button role=tab aria-controls=wallet aria-selected=true>지갑</button><li class=nav-item role=presentation><button class=nav-link id=tab_category data-bs-toggle=tab data-bs-target=#category type=button role=tab aria-controls=category aria-selected=false>분류</button></ul></div><div id=tab_body><div id=list_wallet style=display:none></div><div id=list_category style=display:none></div></div></div><div class=modal-footer><button type=button id=modal_clear class="btn btn-lg btn-warning me-auto">초기화</button> <button type=button id=modal_ok class="btn btn-lg btn-primary">적용</button> <button type=button class="btn btn-lg btn-secondary" data-bs-dismiss=modal>취소</button></div></div></div></div></page><script>function onOpened(c){stracer("filter.balance.html").log("dpopver:",c);var e=c.getParam();function a(e,c){var c="pvgroup_"+(c||0),t=$("<div/>").addClass("sb-card card border w-100 mb-1").html(`
    <div class="card-header d-flex align-items-center p-1" style="height:35px;">
        <div class="d-flex flex-fill align-items-center h-100">
            <input class="form-check-input" type="checkbox" id="item_check">
            <label class="form-check-label item-flex-center ps-2" for="" id="item_title"></label>
        </div>
        <div class="ms-1 ps-4">
            <button type="button" class="transparent-bgcolor"
                data-bs-toggle="collapse" data-bs-target=".group_x" aria-expanded="false" aria-controls=".group_x">
                <div class="collapse hide group_x"><img style="height:24px;" src="https://lclasser.github.io/sbalance/public/image/card_down.svg"></div>
                <div class="collapse show group_x"><img style="height:24px;" src="https://lclasser.github.io/sbalance/public/image/card_up.svg"></div>
            </button>
        </div>
    </div>
    <div class="card-body p-0">
        <ul class="list-group list-group-flush collapse show group_x"></ul>
    </div>
    </ul>`);return t.find("#item_check").attr("id",c),t.find("#item_title").html(e),t.find("#item_title").attr("for",c),t.find(".group_x").removeClass("group_x").addClass(c),t.find('[data-bs-target=".group_x"]').attr("data-bs-target","."+c),t.find('[aria-controls=".group_x"]').attr("aria-controls",c),t.find("#"+c).click(function(){var e=$(this).prop("checked");t.find('[type="checkbox"]').prop("checked",e)}),t._grp_index=c,t}function i(e,c,t,a,l){t=$(`
            <li class="list-group-item list-group-item-action pt-0 pb-0" ikey="${c}">
                <div class="form-check item-flex-center" style="height:36px;">
                    <input class="form-check-input" type="checkbox" value="${t}" id="${c}">
                    <label class="form-check-label item-flex-center ps-2" for="${c}">
                        ${a} ${null!=l?"("+l+")":""}
                    </label>
                </div>
            </li>`);return e.find(".list-group").append(t),t}var n={tab_wallet:c.find("#list_wallet"),tab_category:c.find("#list_category")},o={acc_keys:null,ci_idxs:null},e=(null!=e&&(e.acc_key&&e.acc_key.forEach(function(e){o.acc_keys=o.acc_keys||{},o.acc_keys[e]=!0}),e.ci_idx)&&e.ci_idx.forEach(function(e){o.ci_idxs=o.ci_idxs||{},o.ci_idxs[e]=!0}),window.SBalance.request("/main/account/list").then(function(e){stracer("filter.balance.html").log("/main/account/list:",e);var l={self:a("본인",1),link:a("공유",2)};e.data.forEach(function(e,c){var t=null,a=null;switch(e.acc_type){case"A":case"S":a=l.self;break;case"L":a=l.link}null!=a&&(t=i(a,"wallet_"+c,e.acc_key,e.acc_alias,e.acc_company),a._count=l.self._count||0,a._count++,null!=o.acc_keys&&1!=o.acc_keys[e.acc_key]||t.find('[type="checkbox"]').prop("checked",!0))}),0<l.self._count&&n.tab_wallet.append(l.self),0<l.link._count&&n.tab_wallet.append(l.link)})),t=window.SBalance.request("/main/category/item/list").then(function(e){stracer("filter.balance.html").log("/main/category/list:",e);var t={};e.data.forEach(function(e,c){null==t[e.cg_key]&&(t[e.cg_key]=a(e.disp_alias,c),n.tab_category.append(t[e.cg_key]));c=i(t[e.cg_key],"category_"+c,e.ci_idx,e.ci_name);!c||null!=o.ci_idxs&&1!=o.ci_idxs[e.ci_idx]||c.find('[type="checkbox"]').prop("checked",!0)})});Promise.all([e,t]).then(function(){stracer("filter.balance.html").log("/query finish"),c.$body.css("disply","block"),$('button[data-bs-toggle="tab"]').on("shown.bs.tab",function(e){stracer("filter.balance.html").log("event:",e),Object.values(n).forEach(function(e){e.hide()}),n[e.target.id].show()}),n[($('button[data-bs-toggle="tab"].active')[0]||{}).id].show()}),c.find("#modal_clear").click(function(){c.find('[type="checkbox"]').prop("checked",!0)}),c.find("#modal_ok").click(function(){var t={acc_key:[],ci_idx:[]},e=n.tab_wallet.find(".card-body [type=checkbox]"),e=(n.tab_wallet.find(".card-body [type=checkbox]:checked").each(function(e,c){t.acc_key.push(c.value)}),e.length<=t.acc_key.length&&delete t.acc_key,n.tab_wallet.find(".card-body [type=checkbox]"));n.tab_category.find(".card-body [type=checkbox]:checked").each(function(e,c){t.ci_idx.push(c.value)}),e.length<=t.ci_idx.length&&delete t.ci_idx,stracer("filter.balance.html").log("result:",t),c.close(t)})}function onLoaded(e){stracer("filter.balance.html").log("onLoaded:",e)}function onClosed(e){stracer("filter.balance.html").log("onClosed:",e)}</script>