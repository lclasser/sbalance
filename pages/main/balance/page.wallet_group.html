<link href=https://lclasser.github.io/sbalance/pages/main/balance/page.wallet_group.css rel=stylesheet><div page-declare=dpage class=sb-page onload=onPageLoad(this)><div id=list_items class="overflow-hidden theme-card-body"></div></div><script>function inquire_wallet(s,a,t){console.log("inbound:",a);var i={sum_count:0,sum_withdraw:amountAdd(),sum_deposit:amountAdd()},c={self:{title:"본인",wallets:{}},link:{title:"공유",wallets:{}}};Promise.resolve().then(function(){return window.SBalance.request("/main/account/list")}).then(function(a){a.data.forEach(function(a,t){var e=null,n=null,n="L"===a.acc_type?(e=c.link,a.acc_name):(e=c.self,a.acc_key);e.wallets[n]=a})}).then(function(){return window.SBalance.request("/main/message/wallet",a)}).then(function(a){console.log("res:",a),s.find("#list_items").empty(),a.data.forEach(function(a,t){var e=null,e="L"===a.acc_type?c.link:c.self;a.acc_key=a.acc_key||"",e.wallets[a.acc_key]=Object.assign(e.wallets[a.acc_key]||{},a)});Object.keys(c).forEach(function(a,t){var a=c[a],t="group_"+t,e=$("<div/>"),n=(e.addClass("sb-card card").html(`
        <div class="card-header">
            <div class="flex-grow-1" id="grp_name">지갑</div>
            <button type="button" class="transparent-bgcolor" 
                id="item_collapse"
                data-bs-toggle="collapse" data-bs-target=".group_x" 
                aria-expanded="false" aria-controls=".group_x">
                <div class="collapse hide group_x"><img style="height:24px;" src="https://lclasser.github.io/sbalance/public/image/card_down.svg"></div>
                <div class="collapse show group_x"><img style="height:24px;" src="https://lclasser.github.io/sbalance/public/image/card_up.svg"></div>
            </button>
        </div>
        <div class="card-body p-0 collapse show group_x">
        </div>`),e.find("#grp_name").html(""+(a.title||"-")),e.find("#item_collapse")),l=(n.attr("data-bs-target","."+t),n.attr("aria-controls","."+t),e.find(".group_x").removeClass("group_x").addClass(t),e.find(".card-body"));Object.values(a.wallets).forEach(function(t,a){var e=$("<div/>");e.addClass("d-flex align-items-center border-0 m-0 h-100").css("min-height","54px").css("padding-right","6px").html(`
        <div class="d-flex align-items-center ps-1 pe-1 row col-4">
            <div class="d-flex" id="acc_company">금융사</div>
            <div class="d-flex" id="acc_alias">별칭</div>
        </div>
        <div class="d-flex align-items-center ps-1 pe-1 col justify-content-end" id="deposit_amount">입금금액</div>
        <div class="d-flex align-items-center ps-1 pe-1 col-1 justify-content-end" id="deposit_count">개수</div>
        <div class="d-flex align-items-center ps-1 pe-1 col justify-content-end" id="withdraw_amount">출금금액</div>
        <div class="d-flex align-items-center ps-1 pe-1 col-1 justify-content-end" id="withdraw_count">개수</div>`),null==t.acc_key||t.acc_key.length<=0?(e.find("#acc_company").html("(미지정)"),e.find("#acc_alias").html("")):(e.find("#acc_company").html(t.acc_company),e.find("#acc_alias").html(t.acc_alias)),e.find("#deposit_count").html(t.deposit_count||""),e.find("#deposit_amount").html(amountFormat(null,t.deposit_amount)).addClass("amount-deposit"),e.find("#withdraw_count").html(t.withdraw_count||""),e.find("#withdraw_amount").html(amountFormat(null,t.withdraw_amount)).addClass("amount-withdraw"),amountAdd(i.sum_withdraw,t.withdraw_amount),amountAdd(i.sum_deposit,t.deposit_amount),i.sum_count++,e.click(function(a){return s.getFrame().openPage("https://lclasser.github.io/sbalance/pages/main/balance/page.wallet_item.html",t.acc_alias||"(미지정)",t),!1}),0<a&&l.append($('<div class="seperater m-0 w-100"/>')),l.append(e)}),s.find("#list_items").append(e)}),t(i)})}function onPageLoad(a){STracer("page.wallet_group.html").log("onPageLoad...");var e=a.getPage(),n=e.getReference("balances");function l(){var t=e.getFrame().getBalanceSum(),a={year:n.now_date.getFullYear(),month:n.now_date.getMonth()+1,sms_class:t&&t[0].getSummaryClass()};inquire_wallet(e,a,function(a){t&&t[0].setSummaryResult(a,l)})}e.on("refresh",function(a,t){console.log(e.getFile()+": refresh",a,t),l()}),l()}</script>