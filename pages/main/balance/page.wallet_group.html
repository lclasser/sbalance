<div page-declare=dpage class=sb-page onload=onPageLoad(this)><div id=list_items class="column-scroll overflow-hidden"></div></div><script>function inquire_wallet(n,a,e){stracer("page.wallet_group.js").log("inbound:",a);var o={sum_count:0,sum_withdraw:amountAdd(),sum_deposit:amountAdd()},d={self:{title:"본인",icon:"https://lclasser.github.io/sbalance/public/image/icon_user.svg",class:"self-text",wallets:{}},link:{title:"공유",icon:"https://lclasser.github.io/sbalance/public/image/icon_share.svg",class:"share-text",wallets:{}}};Promise.resolve().then(function(){return window.SBalance.request("/main/account/list")}).then(function(a){a.data.forEach(function(a,e){var t=null,s=null,s="L"===a.acc_type?(t=d.link,a.acc_name):(t=d.self,a.acc_key);t.wallets[s]=a})}).then(function(){return window.SBalance.request("/main/message/wallet",a)}).then(function(a){stracer("page.wallet_group.js").log("res:",a),n.find("#list_items").empty(),a.data.forEach(function(a,e){var t=null,t="L"===a.acc_type?d.link:d.self;a.acc_key=a.acc_key||"",t.wallets[a.acc_key]=Object.assign(t.wallets[a.acc_key]||{},a)});var c=n.getFrame().getOwner().getTemper(),i=n.get$page();Object.keys(d).forEach(function(a,e){var s=d[a],a="group_"+e,e=$(`
        <div class="sb-card card">
        <div class="card-header">
            <div class="d-flex flex-grow-1 align-items-center">
                <img id="grp_icon" class="p-1 pe-2" src="">
                <span id="grp_name" class="">지갑<span>
            </div>
            <button type="button" class="transparent-bgcolor" 
                id="item_collapse"
                data-bs-toggle="collapse" data-bs-target=".group_x" 
                aria-expanded="false" aria-controls=".group_x">
                <div class="collapse hide group_x"><img style="height:24px;" src="https://lclasser.github.io/sbalance/public/image/card_down.svg"></div>
                <div class="collapse show group_x"><img style="height:24px;" src="https://lclasser.github.io/sbalance/public/image/card_up.svg"></div>
            </button>
        </div>
        <div class="card-body p-0 collapse show group_x">
        </div>
        </div>`),t=(e.find("#grp_icon").prop("src",s.icon||""),e.find("#grp_name").html(""+(s.title||"-")),e.find("#item_collapse")),l=(t.attr("data-bs-target","."+a),t.attr("aria-controls","."+a),e.find(".group_x").removeClass("group_x").addClass(a),e.find(".card-body"));Object.values(s.wallets).forEach(function(e,a){var t=$(`
        <div class="d-flex justify-content-center flex-column p-1" style="min-height:54px;">
            <div class="d-flex w-100">
                <div class="d-flex col-2 me-3" id="acc_company">금융사</div>
                <div class="d-flex text-truncate" id="acc_alias">별칭</div>
            </div>
            <div class="d-flex align-items-center flex-row w-100">
                <div class="d-flex ps-1 pe-1 col justify-content-end" id="deposit_amount">입금금액</div>
                <div class="d-flex ps-1 pe-1 col-1 justify-content-end memo-text" id="deposit_count">개수</div>
                <div class="d-flex ps-1 pe-1 col justify-content-end" id="withdraw_amount">출금금액</div>
                <div class="d-flex ps-1 pe-1 col-1 justify-content-end memo-text" id="withdraw_count">개수</div>
            </div>
        </div>`);null==e.acc_key||e.acc_key.length<=0?(t.find("#acc_company").html("(미지정)"),t.find("#acc_alias").html("")):(t.find("#acc_company").html(e.acc_company),t.find("#acc_alias").html(e.acc_alias)),t.find("#acc_company").addClass(s.class),t.find("#deposit_count").html(e.deposit_count||""),t.find("#deposit_amount").html(amountFormat(null,e.deposit_amount)).addClass("amount-deposit"),t.find("#withdraw_count").html(e.withdraw_count||""),t.find("#withdraw_amount").html(amountFormat(null,e.withdraw_amount)).addClass("amount-withdraw"),amountAdd(o.sum_withdraw,e.withdraw_amount),amountAdd(o.sum_deposit,e.deposit_amount),o.sum_count++,t.click(function(a){return c.scroll_pos=i.scrollTop(),n.getFrame().openPage("https://lclasser.github.io/sbalance/pages/main/balance/page.wallet_item.html",e.acc_alias||"(미지정)",e),!1}),0<a&&l.append($('<div class="seperater m-0 w-100"/>')),l.append(t)}),n.find("#list_items").append(e)}),c.scroll_pos&&i.scrollTop(c.scroll_pos),e(o)})}function onPageLoad(a){stracer("page.wallet_group.html").log("onPageLoad...");var t=a.getPage(),s=t.getReference("balances");function l(){var e=t.getFrame().getBalanceSum(),a={year:s.now_date.getFullYear(),month:s.now_date.getMonth()+1,sms_class:e&&e[0].getSummaryClass()};inquire_wallet(t,a,function(a){e&&e[0].setSummaryResult(a,l)})}t.on("refresh",function(a,e){stracer("page.wallet_group.html").log(t.getFile()+": refresh",a,e),l()}),l()}</script>