<style>.fixed-amount{width:100px}</style><div page-declare=dpage class=sb-page onload=onPageLoad(this)><div id=list_items class="column-scroll overflow-hidden"></div></div><script>function inquire_category(r,t,e){stracer("page.category_group.html").log("inbound:",t);var d={sum_count:0,sum_withdraw:amountAdd(),sum_deposit:amountAdd()},c={"":{grp_withdraw:amountAdd(),grp_deposit:amountAdd(),grp_budget:amountAdd(),cg_alias:"미분류",ci_idxs:{0:"0"},item_list:{0:{item_withdraw:amountAdd(),item_deposit:amountAdd(),ci_type:"N"}},sms_unit:"KRW"}};Promise.resolve().then(function(){return window.SBalance.request("/main/category/item/list",null)}).then(function(t){stracer("page.category_group.html").log("item/list:",t),t.data.forEach(function(t){var e,a;"E"!=t.ci_type&&(t.ci_type=t.ci_type||"N",t.ci_idx=t.ci_idx||"0",e=t.cg_key||"",a=c[e]||{grp_withdraw:amountAdd(),grp_deposit:amountAdd(),grp_budget:amountAdd(),cg_key:e,cg_alias:t.grp_mark,cg_sort:t.cg_sort,cg_type:t.cg_type,item_list:{},sms_unit:"KRW"},(c[e]=a).item_list[t.ci_idx]=Object.assign({item_withdraw:amountAdd(),item_deposit:amountAdd()},t),amountAdd(a.grp_budget,t.ci_budget))})}).then(function(){return window.SBalance.request("/main/message/daily",t)}).then(function(t){var n,o;stracer("page.category_group.html").log("res:",t),null==t.data.rows||t.data.rows.length<=0?(r.find("#list_items").html('<div class="row m-1" style="height:30px;">데이터가 없습니다.</div>'),e()):(n=r.getFrame().getOwner().getTemper(),o=r.get$page(),r.find("#list_items").empty(),t.data.rows.forEach(function(t){if("E"!=t.ci_type){t.cg_key=t.cg_key||"",t.ci_type=t.ci_type||"N",t.ci_idx=t.ci_idx||"0";var e=c[t.cg_key],a=(null==e&&((e=c[""]).ci_idxs[t.ci_idx]=t.ci_idx,t.ci_idx="0"),e.item_list[t.ci_idx]),i=t.sms_amount,s=!0;switch(t.sms_type){case"C":i*=-1;break;case"P":break;default:s=!1}switch(t.sms_display){case"E":s=!1;break;case"H":return}switch(t.acc_display){case"E":s=!1;break;case"H":return}if(1<t.sms_iment&&(i=t.sms_iamount),1==s){switch(t.sms_class){case"W":amountAdd(a.item_withdraw,i),"N"==t.ci_type&&(amountAdd(e.grp_withdraw,i),amountAdd(d.sum_withdraw,i));break;case"D":amountAdd(a.item_deposit,i),"N"==t.ci_type&&(amountAdd(e.grp_deposit,i),amountAdd(d.sum_deposit,i))}"N"==t.ci_type&&d.sum_count++,e.sms_unit=t.sms_unit}else switch(t.sms_class){case"W":amountAdd(a.item_withdraw,0,!0);break;case"D":amountAdd(a.item_deposit,0,!0)}}}),stracer("page.category_group.html").log("clists:",c),Object.values(c).sort(function(t,e){return t.cg_sort-e.cg_sort}).forEach(function(s,t){var e="group_"+t,a=$("<div/>");switch(a.addClass("sb-card card").html(`
        <div class="card-header">
            <div class="d-flex flex-wrap justify-content-end w-100">
                <div class="d-flex" style="flex:1 1 60px; min-width:60px;">
                    <span class="text-truncate" id="grp_name">분류</span>
                </div>
                <div class="d-flex flex-wrap justify-content-end">
                    <div class="fixed-amount amount-budget text-end"></div>
                    <div class="fixed-amount amount-deposit text-end"></div>
                    <div class="fixed-amount amount-withdraw text-end"></div>
                </div>
            </div>
            <button type="button" class="transparent-bgcolor ms-auto" 
                id="item_collapse" data-bs-toggle="collapse" data-bs-target=".group_x" aria-controls=".group_x" aria-expanded="true">
                <div class="collapse hide group_x"><img style="height:24px;" src="https://lclasser.github.io/sbalance/public/image/card_down.svg"></div>
                <div class="collapse show group_x"><img style="height:24px;" src="https://lclasser.github.io/sbalance/public/image/card_up.svg"></div>
            </button>
        </div>
        <div class="card-body p-0 collapse show group_x">
        </div>`),a.find(".group_x").removeClass("group_x").addClass(e),a.find("#grp_name").html(""+(s.cg_alias||"미분류")),s.cg_type){case"S":a.find("#grp_name").addClass("self-text");break;case"L":a.find("#grp_name").addClass("share-text")}a.find(".amount-withdraw").html(""+amountFormat(s.sms_unit,s.grp_withdraw)),a.find(".amount-deposit").html(""+amountFormat(s.sms_unit,s.grp_deposit)),a.find(".amount-budget").html(""+amountFormat(s.sms_unit,s.grp_budget)),n.collapse=n.collapse||{};var t=a.find("#item_collapse"),d=(t.attr("data-bs-target","."+e),t.attr("aria-controls","."+e),t.on("show.bs.collapse",function(){n.collapse[e]="true"}),t.on("hide.bs.collapse",function(){n.collapse[e]="false"}),"false"==n.collapse[e]&&(t.find(".collapse").collapse("toggle"),a.find(".card-body").collapse("toggle")),a.find(".card-body"));Object.keys(s.item_list).forEach(function(t,e){var a=s.item_list[t];if(0!=toInteger(a.ci_budget)||0!=a.item_withdraw.val()||0!=a.item_deposit.val()){var i=$(`
        <div class="d-flex align-items-center justify-content-end border-0" style="min-height:54px; padding-right:6px">
            <div class="d-flex align-items-center flex-grow-1 p-1"><div class="icon_category" id="item_category">분류</div></div>
            <div class="fixed-amount d-flex justify-content-end p-0 text-truncate text-end" id="item_budget">예산</div>
            <div class="fixed-amount d-flex justify-content-end p-0" id="item_deposit">금액</div>
            <div class="fixed-amount d-flex justify-content-end p-0" id="item_withdraw">금액</div>
            <div class="d-flex align-items-center justify-content-end p-0" style="width:29px;"></div>
        </div>`),t=i.find("#item_category");switch(t.html(`<span class="align-middle text-wrap">${formaterName4(a.ci_name,a.grp_mark)}</span>`),"L"==a.cg_type&&t.addClass("shared"),i.find("#item_budget").html(""+amountFormat(s.sms_unit,a.ci_budget)),a.ci_type){case"N":i.find("#item_withdraw").html(""+amountFormat(s.sms_unit,a.item_withdraw)).addClass("amount-withdraw"),i.find("#item_deposit").html(""+amountFormat(s.sms_unit,a.item_deposit)).addClass("amount-deposit");break;case"T":i.find("#item_withdraw").html(""+amountFormat(s.sms_unit,a.item_withdraw)).addClass("transfer-withdraw"),i.find("#item_deposit").html(""+amountFormat(s.sms_unit,a.item_deposit)).addClass("transfer-deposit")}i.click(function(t){return n.scroll_pos=o.scrollTop(),null!=s.ci_idxs&&(a.ci_idxs=s.ci_idxs),r.getFrame().openPage("https://lclasser.github.io/sbalance/pages/main/balance/page.category_item.html",a.ci_name||"미분류",a),!1}),0<e&&d.append($('<div class="seperater m-0 w-100"/>')),d.append(i)}}),r.find("#list_items").append(a)}),n.scroll_pos&&o.scrollTop(n.scroll_pos),e(d))})}function onPageLoad(t){var a=t.getPage(),i=a.getReference("balances");function s(){var e=a.getFrame().getBalanceSum(),t={year:i.now_date.getFullYear(),month:i.now_date.getMonth()+1,sms_class:e&&e[0].getSummaryClass()},t=Object.assign(t,i.filter);inquire_category(a,t,function(t){e&&e[0].setSummaryResult(t,s)})}a.on("refresh",function(t,e){stracer("page.category_group.html").log(a.getFile()+": refresh",t,e),s()}),s()}</script>