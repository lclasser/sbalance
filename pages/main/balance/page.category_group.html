<link href=https://lclasser.github.io/sbalance/pages/main/balance/page.category_group.css rel=stylesheet><div page-declare=dpage class="h-100 w-100" onload=onPageLoad(this)><div id=list_items class=overflow-hidden></div></div><script>function inquire_category(c,t,i){console.log("inbound:",t);var d={sum_count:0,sum_withdraw:amountAdd(),sum_deposit:amountAdd()},l={"":{grp_withdraw:amountAdd(),grp_deposit:amountAdd(),grp_budget:amountAdd(),cg_name:"미분류",ci_idxs:{0:"0"},item_list:{0:{item_withdraw:amountAdd(),item_deposit:amountAdd(),ci_type:"N"}},sms_unit:"KRW"}};Promise.resolve().then(function(){return window.SBalance.request("/main/category/item/select",null)}).then(function(t){console.log("item/select:",t),t.data.forEach(function(t){var e,i;"E"!=t.ci_type&&(t.ci_type=t.ci_type||"N",t.ci_idx=t.ci_idx||"0",e=null,e="L"==t.cg_type?t.cg_link||"":t.cg_key||"",i=l[e]||{grp_withdraw:amountAdd(),grp_deposit:amountAdd(),grp_budget:amountAdd(),cg_key:e,cg_name:t.cg_name,cg_sort:t.cg_sort,item_list:{},sms_unit:"KRW"},(l[e]=i).item_list[t.ci_idx]=Object.assign({item_withdraw:amountAdd(),item_deposit:amountAdd()},t),amountAdd(i.grp_budget,t.ci_budget))})}).then(function(){return window.SBalance.request("/main/message/daily",t)}).then(function(t){var e,n,o;console.log("res:",t),null==t.data||t.data.length<=0?(c.find("#list_items").html('<div class="row m-1" style="height:30px;">데이터가 없습니다.</div>'),i()):(e=c.getFrame().getOwner(),n=e.getFrame().get$body(),o=e.getTemper(),c.find("#list_items").empty(),t.data.forEach(function(t){if("E"!=t.ci_type){t.cg_key=t.cg_key||"",t.ci_type=t.ci_type||"N",t.ci_idx=t.ci_idx||"0";var e=l[t.cg_key],i=(null==e&&((e=l[""]).ci_idxs[t.ci_idx]=t.ci_idx,t.ci_idx="0"),e.item_list[t.ci_idx]),s=t.sms_amount,a=!0;switch(t.sms_type){case"C":s*=-1;break;case"P":break;default:a=!1}switch(t.sms_display){case"E":a=!1;break;case"H":return}switch(t.acc_display){case"E":a=!1;break;case"H":return}if(1<t.sms_iment&&(t.sms_iment==t.sms_imonth?s=s/t.sms_iment+s%t.sms_iment:s/=t.sms_iment),1==a){switch(t.sms_class){case"W":amountAdd(i.item_withdraw,s),"N"==t.ci_type&&(amountAdd(e.grp_withdraw,s),amountAdd(d.sum_withdraw,s));break;case"D":amountAdd(i.item_deposit,s),"N"==t.ci_type&&(amountAdd(e.grp_deposit,s),amountAdd(d.sum_deposit,s))}"N"==t.ci_type&&d.sum_count++,e.sms_unit=t.sms_unit}else switch(t.sms_class){case"W":amountAdd(i.item_withdraw,0,!0);break;case"D":amountAdd(i.item_deposit,0,!0)}}}),console.log("clists:",l),Object.values(l).sort(function(t,e){return t.cg_sort-e.cg_sort}).forEach(function(a,t){var t="group_"+t,e=$("<div/>"),i=(e.addClass("sb-card card").html(`
        <div class="card-header">
            <div class="d-flex flex-shrink-1 flex-grow-1 flex-wrap justify-content-end">
                <div class="d-flex flex-shrink-1 flex-grow-1" style="flex-basis:60px; width:60px;">
                    <span class="text-truncate" id="grp_name">분류</span>
                </div>
                <div class="d-flex flex-wrap justify-content-end">
                    <div class="amount-budget text-end"></div>
                    <div class="d-flex">
                        <div class="amount-deposit text-end"></div>
                        <div class="amount-withdraw text-end"></div>
                    </div>
                </div>
            </div>
            <button type="button" class="transparent-bgcolor ms-auto p-0" 
                id="item_collapse" data-bs-toggle="collapse" data-bs-target=".group_x" aria-controls=".group_x" aria-expanded="true">
                <div class="collapse hide group_x"><img style="height:24px;" src="https://lclasser.github.io/sbalance/public/image/card_down.svg"></div>
                <div class="collapse show group_x"><img style="height:24px;" src="https://lclasser.github.io/sbalance/public/image/card_up.svg"></div>
            </button>
        </div>
        <div class="card-body p-0 collapse show group_x">
        </div>`),e.find("#grp_name").html(""+(a.cg_name||"미분류")),e.find(".amount-withdraw").html(""+amountFormat(a.sms_unit,a.grp_withdraw)),e.find(".amount-deposit").html(""+amountFormat(a.sms_unit,a.grp_deposit)),e.find(".amount-budget").html(""+amountFormat(a.sms_unit,a.grp_budget)),o.collapse=o.collapse||{},e.find("#item_collapse")),d=(i.attr("data-bs-target","."+t),i.attr("aria-controls","."+t),e.find(".group_x").removeClass("group_x").addClass(t),i.click(function(){o.collapse[a.cg_key]=i.attr("aria-expanded")}),"false"==o.collapse[a.cg_key]&&(i.find(".collapse").collapse("toggle"),e.find(".card-body").collapse("toggle")),e.find(".card-body"));Object.keys(a.item_list).forEach(function(t,e){var i=a.item_list[t];if(0!=toInteger(i.ci_budget)||0!=i.item_withdraw.val()||0!=i.item_deposit.val()){var s=$("<div/>"),t=(s.addClass("d-flex align-items-center border-0 m-0 h-100").css("min-height","54px").css("padding-right","6px").html(`
        <div class="flex-grow-1 d-flex align-items-center p-1"><div class="icon_category" id="item_category">분류</div></div>
        <div class="d-flex align-items-center justify-content-end p-0 text-truncate text-end" id="item_budget">예산</div>
        <div class="d-flex align-items-center justify-content-end p-0" id="item_deposit">금액</div>
        <div class="d-flex align-items-center justify-content-end p-0" id="item_withdraw">금액</div>
        <div class="d-flex align-items-center justify-content-end p-0" style="width:29px;"></div>`),s.find("#item_category"));switch(t.html(`<span class="align-middle text-wrap">${formaterName4(i.ci_name)}</span>`),"L"==i.cg_type&&t.addClass("shared"),s.find("#item_budget").html(""+amountFormat(a.sms_unit,i.ci_budget)),i.ci_type){case"N":s.find("#item_withdraw").html(""+amountFormat(a.sms_unit,i.item_withdraw)).addClass("amount-withdraw"),s.find("#item_deposit").html(""+amountFormat(a.sms_unit,i.item_deposit)).addClass("amount-deposit");break;case"T":s.find("#item_withdraw").html(""+amountFormat(a.sms_unit,i.item_withdraw)).addClass("transfer-withdraw"),s.find("#item_deposit").html(""+amountFormat(a.sms_unit,i.item_deposit)).addClass("transfer-deposit")}s.click(function(t){return o.scroll_pos=n.scrollTop(),console.log("row:",i),null!=a.ci_idxs&&(i.ci_idxs=a.ci_idxs),c.getFrame().openPage("https://lclasser.github.io/sbalance/pages/main/balance/page.category_item.html",i.ci_name||"미분류",i),!1}),0<e&&d.append($('<div class="seperater m-0 w-100"/>')),d.append(s)}}),e.on("mousedown",function(){e.cdelay=setTimeout(function(){console.log("zxcv")},1500)}).on("mouseup",function(){null!=e.cdelay&&(clearTimeout(e.cdelay),e.cdelay=null)}).on("mouseout",function(){null!=e.cdelay&&(clearTimeout(e.cdelay),e.cdelay=null)}),c.find("#list_items").append(e)}),o.scroll_pos&&n.scrollTop(o.scroll_pos),i(d))})}function onPageLoad(t){var i=t.getPage(),s=i.getReference("balances");function a(){var e=i.getFrame().getBalanceSum(),t={year:s.now_date.getFullYear(),month:s.now_date.getMonth()+1,sms_class:e&&e[0].getSummaryClass()},t=Object.assign(t,s.filter);inquire_category(i,t,function(t){e&&e[0].setSummaryResult(t,a)})}i.on("refresh",function(t,e){console.log(i.getFile()+": refresh",t,e),a()}),a()}</script>