<style>.fixed-amount{width:100px}</style><div page-declare=dpage class=sb-page onload=onPageLoad(this)><div id=list_items class=overflow-hidden></div></div><script>function inquire_category(c,t,i){console.log("inbound:",t);var d={sum_count:0,sum_withdraw:amountAdd(),sum_deposit:amountAdd()},l={"":{grp_withdraw:amountAdd(),grp_deposit:amountAdd(),grp_budget:amountAdd(),cg_name:"미분류",ci_idxs:{0:"0"},item_list:{0:{item_withdraw:amountAdd(),item_deposit:amountAdd(),ci_type:"N"}},sms_unit:"KRW"}};Promise.resolve().then(function(){return window.SBalance.request("/main/category/item/select",null)}).then(function(t){console.log("item/select:",t),t.data.forEach(function(t){var e,i;"E"!=t.ci_type&&(t.ci_type=t.ci_type||"N",t.ci_idx=t.ci_idx||"0",e=null,e="L"==t.cg_type?t.cg_link||"":t.cg_key||"",i=l[e]||{grp_withdraw:amountAdd(),grp_deposit:amountAdd(),grp_budget:amountAdd(),cg_key:e,cg_name:t.cg_name,cg_sort:t.cg_sort,cg_type:t.cg_type,item_list:{},sms_unit:"KRW"},(l[e]=i).item_list[t.ci_idx]=Object.assign({item_withdraw:amountAdd(),item_deposit:amountAdd()},t),amountAdd(i.grp_budget,t.ci_budget))})}).then(function(){return window.SBalance.request("/main/message/daily",t)}).then(function(t){var e,n,o;console.log("res:",t),null==t.data||t.data.length<=0?(c.find("#list_items").html('<div class="row m-1" style="height:30px;">데이터가 없습니다.</div>'),i()):(e=c.getFrame().getOwner(),n=e.getFrame().get$body(),o=e.getTemper(),c.find("#list_items").empty(),t.data.forEach(function(t){if("E"!=t.ci_type){t.cg_key=t.cg_key||"",t.ci_type=t.ci_type||"N",t.ci_idx=t.ci_idx||"0";var e=l[t.cg_key],i=(null==e&&((e=l[""]).ci_idxs[t.ci_idx]=t.ci_idx,t.ci_idx="0"),e.item_list[t.ci_idx]),a=t.sms_amount,s=!0;switch(t.sms_type){case"C":a*=-1;break;case"P":break;default:s=!1}switch(t.sms_display){case"E":s=!1;break;case"H":return}switch(t.acc_display){case"E":s=!1;break;case"H":return}if(1<t.sms_iment&&(a=t.sms_iamount),1==s){switch(t.sms_class){case"W":amountAdd(i.item_withdraw,a),"N"==t.ci_type&&(amountAdd(e.grp_withdraw,a),amountAdd(d.sum_withdraw,a));break;case"D":amountAdd(i.item_deposit,a),"N"==t.ci_type&&(amountAdd(e.grp_deposit,a),amountAdd(d.sum_deposit,a))}"N"==t.ci_type&&d.sum_count++,e.sms_unit=t.sms_unit}else switch(t.sms_class){case"W":amountAdd(i.item_withdraw,0,!0);break;case"D":amountAdd(i.item_deposit,0,!0)}}}),console.log("clists:",l),Object.values(l).sort(function(t,e){return t.cg_sort-e.cg_sort}).forEach(function(s,t){var t="group_"+t,e=$("<div/>");switch(e.addClass("sb-card card").html(`
        <div class="card-header">
            <div class="d-flex flex-wrap justify-content-end w-100">
                <div class="d-flex" style="flex:1 1 60px; min-width:60px;">
                    <span class="text-truncate" id="grp_name">분류</span>
                </div>
                <div class="d-flex flex-wrap justify-content-end">
                    <div class="fixed-amount amount-budget text-end"></div>
                    <div class="fixed-amount amount-deposit text-end"></div>
                    <div class="fixed-amount amount-withdraw text-end"></div>
                </div>
            </div>
            <button type="button" class="transparent-bgcolor ms-auto" 
                id="item_collapse" data-bs-toggle="collapse" data-bs-target=".group_x" aria-controls=".group_x" aria-expanded="true">
                <div class="collapse hide group_x"><img style="height:24px;" src="https://lclasser.github.io/sbalance/public/image/card_down.svg"></div>
                <div class="collapse show group_x"><img style="height:24px;" src="https://lclasser.github.io/sbalance/public/image/card_up.svg"></div>
            </button>
        </div>
        <div class="card-body p-0 collapse show group_x">
        </div>`),e.find("#grp_name").html(""+(s.cg_name||"미분류")),s.cg_type){case"S":e.find("#grp_name").addClass("self-text");break;case"L":e.find("#grp_name").addClass("share-text")}e.find(".amount-withdraw").html(""+amountFormat(s.sms_unit,s.grp_withdraw)),e.find(".amount-deposit").html(""+amountFormat(s.sms_unit,s.grp_deposit)),e.find(".amount-budget").html(""+amountFormat(s.sms_unit,s.grp_budget)),o.collapse=o.collapse||{};var i=e.find("#item_collapse"),d=(i.attr("data-bs-target","."+t),i.attr("aria-controls","."+t),e.find(".group_x").removeClass("group_x").addClass(t),i.click(function(){o.collapse[s.cg_key]=i.attr("aria-expanded")}),"false"==o.collapse[s.cg_key]&&(i.find(".collapse").collapse("toggle"),e.find(".card-body").collapse("toggle")),e.find(".card-body"));Object.keys(s.item_list).forEach(function(t,e){var i=s.item_list[t];if(0!=toInteger(i.ci_budget)||0!=i.item_withdraw.val()||0!=i.item_deposit.val()){var a=$(`
        <div class="d-flex align-items-center justify-content-end border-0" style="min-height:54px; padding-right:6px">
            <div class="d-flex align-items-center flex-grow-1 p-1"><div class="icon_category" id="item_category">분류</div></div>
            <div class="fixed-amount d-flex justify-content-end p-0 text-truncate text-end" id="item_budget">예산</div>
            <div class="fixed-amount d-flex justify-content-end p-0" id="item_deposit">금액</div>
            <div class="fixed-amount d-flex justify-content-end p-0" id="item_withdraw">금액</div>
            <div class="d-flex align-items-center justify-content-end p-0" style="width:29px;"></div>
        </div>`),t=a.find("#item_category");switch(t.html(`<span class="align-middle text-wrap">${formaterName4(i.ci_name)}</span>`),"L"==i.cg_type&&t.addClass("shared"),a.find("#item_budget").html(""+amountFormat(s.sms_unit,i.ci_budget)),i.ci_type){case"N":a.find("#item_withdraw").html(""+amountFormat(s.sms_unit,i.item_withdraw)).addClass("amount-withdraw"),a.find("#item_deposit").html(""+amountFormat(s.sms_unit,i.item_deposit)).addClass("amount-deposit");break;case"T":a.find("#item_withdraw").html(""+amountFormat(s.sms_unit,i.item_withdraw)).addClass("transfer-withdraw"),a.find("#item_deposit").html(""+amountFormat(s.sms_unit,i.item_deposit)).addClass("transfer-deposit")}a.click(function(t){return o.scroll_pos=n.scrollTop(),console.log("row:",i),null!=s.ci_idxs&&(i.ci_idxs=s.ci_idxs),c.getFrame().openPage("https://lclasser.github.io/sbalance/pages/main/balance/page.category_item.html",i.ci_name||"미분류",i),!1}),0<e&&d.append($('<div class="seperater m-0 w-100"/>')),d.append(a)}}),e.on("mousedown",function(){e.cdelay=setTimeout(function(){console.log("zxcv")},1500)}).on("mouseup",function(){null!=e.cdelay&&(clearTimeout(e.cdelay),e.cdelay=null)}).on("mouseout",function(){null!=e.cdelay&&(clearTimeout(e.cdelay),e.cdelay=null)}),c.find("#list_items").append(e)}),o.scroll_pos&&n.scrollTop(o.scroll_pos),i(d))})}function onPageLoad(t){var i=t.getPage(),a=i.getReference("balances");function s(){var e=i.getFrame().getBalanceSum(),t={year:a.now_date.getFullYear(),month:a.now_date.getMonth()+1,sms_class:e&&e[0].getSummaryClass()},t=Object.assign(t,a.filter);inquire_category(i,t,function(t){e&&e[0].setSummaryResult(t,s)})}i.on("refresh",function(t,e){console.log(i.getFile()+": refresh",t,e),s()}),s()}</script>