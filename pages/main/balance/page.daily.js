function process_daily(s,t,d,i){var e=s.getReference("balances"),l=d.options;return delete(d=1!=d.disable_filter?Object.assign(d,e.filter):d).options,delete d.disable_filter,null==d.acc_key&&delete d.acc_key,stracer("page.daily.js").log("process_daily...",d),window.SBalance.request("/main/message/daily",d).then(function(e){stracer("page.daily.js").log("daily result:",e);var a={sum_count:0,sum_withdraw:amountAdd(),sum_deposit:amountAdd()};null==e.data||e.data.length<=0?t.html('<div class="row m-1" style="height:30px;">데이터가 없습니다.</div>'):process_data_daily(t,a,l,e.data,function(){var e=s.getFrame().get$body(),a=e.scrollTop();process_daily(s,t,d,i).then(function(){a&&e.scrollTop(a)})}),i&&i(a)})}function process_data_daily(d,u,_,e,p){if(_=_||{},u=u||{sum_count:0,sum_withdraw:amountAdd(),sum_deposit:amountAdd()},null==e||e.length<=0)d.html('<div class="row m-1" style="height:30px;">데이터가 없습니다.</div>');else{d.empty();var h={};e.forEach(function(e){h[e.sms_date]=h[e.sms_date]||{items:[],item_date:e.sms_date},h[e.sms_date].items.push(e)});const i=[{week:"일",color:"#F96C4E"},{week:"월",color:"#DBD5D2"},{week:"화",color:"#DBD5D2"},{week:"수",color:"#DBD5D2"},{week:"목",color:"#DBD5D2"},{week:"금",color:"#DBD5D2"},{week:"토",color:"#3C97F5"}];_.show_ads=!1,Object.keys(h).reverse().forEach(function(c,e){var o=h[c],e="group_"+e,a=$('<div class="sb-card card"/>'),s=(a.html(`
    <div class="card-header">
        <div class="daily-day">1 일 </div>
        <div class="daily-week me-auto"></div>
        <div class="amount-deposit text-end" id="sum_deposit" style="width:108px;"></div>
        <div class="amount-withdraw text-end" id="sum_withdraw" style="width:108px;"></div>
        <button type="button" class="transparent-bgcolor" 
            id="item_collapse"
            data-bs-toggle="collapse" data-bs-target=".group_x" 
            aria-expanded="false" aria-controls=".group_x">
            <div class="collapse hide group_x"><img style="height:24px;" src="https://lclasser.github.io/sbalance/public/image/card_down.svg"></div>
            <div class="collapse show group_x"><img style="height:24px;" src="https://lclasser.github.io/sbalance/public/image/card_up.svg"></div>
        </button>
    </div>
    <div class="card-body p-0 collapse show group_x">
    </div>`),formaterNewDate_fromFmtDate(o.item_date)),t=i[s.getDay()];switch(s.getDay()){case 0:a.find(".daily-week").addClass("week-sunday");break;case 6:a.find(".daily-week").addClass("week-satday");break;default:a.find(".daily-week").addClass("week-norday")}1==_.show_month?a.find(".daily-day").html(displayDate_fromFmtDate(o.item_date)):a.find(".daily-day").html(s.getDate()+"일"),a.find(".daily-week").html(""+t.week);var s=a.find("#item_collapse"),n=(s.attr("data-bs-target","."+e),s.attr("aria-controls","."+e),a.find(".group_x").removeClass("group_x").addClass(e),amountAdd()),m=amountAdd(),r=a.find(".card-body");o.items.forEach(function(a,s){o.items.length;var e=$('<div class="row m-0 h-100"/>').css("min-height","48px").html(`
    <div class="col-auto d-flex align-items-center p-1 position-relative"><div class="icon_category" id="item_category">분류</div></div>
    <div class="col d-flex flex-column justify-content-center">
        <div class="row">
            <div class="col text-truncate" id="item_content"></div>
            <div class="col-auto d-flex">
                <div id="item_account" class="pe-1"></div>
                <div id="item_time" class="ps-1"></div>
            </div>
        </div>
        <div class="row">
            <div class="col text-truncate memo-text" id="item_memo" style="width:32px;"></div>
            <div class="col-auto" id="item_amount"></div>
        </div>
    </div>`),t=e.find("#item_category"),d=(t.html(`<span class="align-middle text-wrap">${formaterName4(a.ci_name)}</span>`),"L"==a.acc_type&&t.append($('<img src="https://lclasser.github.io/sbalance/public/image/link_category.svg">')),"L"==a.cg_type&&t.addClass("shared"),t.click(function(){return stracer("page.daily.js").log("cate_icon click."),window.popver("https://lclasser.github.io/sbalance/pages/main/popver/select.category.html",{ci_idx:a.ci_idx||0},function(e){null!=e&&window.SBalance.request("/main/message/update",{acc_key:"L"==a.acc_type?a.acc_name:a.acc_key,acc_type:a.acc_type,acc_name:a.acc_name,msg_key:a.msg_key,sms_category:e.ci_idx}).then(function(e){stracer("page.daily.js").log("/main/message/update res:",e),"Y"==e.error.success?(window.toast({title_class:"bg-secondary text-white",title_text:"분류 정보",mesg_text:"분류를 설정 하였습니다."}),p&&p()):window.toast({title_class:"bg-secondary text-white",title_text:"분류 정보",mesg_text:"분류 설정을 실패 하였습니다."})})}),!1}),null==a.acc_key?e.find("#item_account").html("(미지정)"):e.find("#item_account").html(a.acc_alias),e.find("#item_time").html(a.sms_time.substring(0,2)+":"+a.sms_time.substring(2,4)),e.find("#item_memo").html(a.sms_memo),1<a.sms_iment?e.find("#item_content").html(`(${a.sms_imonth}/${a.sms_iment}) `+a.sms_contents):e.find("#item_content").html(a.sms_contents),a.sms_amount),i=!0;switch(a.sms_type){case"C":d*=-1;break;case"P":break;default:i=!1}switch(1<a.sms_iment&&(d=a.sms_iamount),a.sms_display){case"E":i=!1;break;case"H":return}switch(a.acc_display){case"E":i=!1;break;case"H":return}var l=e.find("#item_amount");if(l.html(amountFormat(a.sms_unit,d)),0==i)l.addClass("unknown-amount");else{switch(a.sms_class){case"W":"N"==a.ci_type||null==a.ci_type?(amountAdd(n,d),amountAdd(u.sum_withdraw,d)):(amountAdd(n,0,!0),amountAdd(u.sum_withdraw,0,!0));break;case"D":"N"==a.ci_type||null==a.ci_type?(amountAdd(m,d),amountAdd(u.sum_deposit,d)):(amountAdd(m,0,!0),amountAdd(u.sum_deposit,0,!0))}if(u.sum_count++,d<0)switch(a.sms_class){case"W":l.addClass("cancel-withdraw");break;case"D":l.addClass("cancel-deposit");break;default:l.addClass("text-dark")}else if("T"==a.ci_type)switch(a.sms_class){case"W":l.addClass("transfer-withdraw");break;case"D":l.addClass("transfer-deposit");break;default:l.addClass("text-dark")}else if("E"==a.ci_type)switch(a.sms_class){case"W":l.addClass("except-withdraw");break;case"D":l.addClass("except-deposit");break;default:l.addClass("text-dark")}else if("N"==a.ci_type||null==a.ci_type)switch(a.sms_class){case"W":l.addClass("amount-withdraw");break;case"D":l.addClass("amount-deposit");break;default:l.addClass("text-dark")}else l.addClass("unknown-amount")}e.click(function(){var e=h[c].items[s];return e.read_only=_.read_only,stracer("page.daily.js").log("row:",e),window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.balance_message.html",e,function(e){stracer("page.daily.js").log("modal.balance_message.html result:",e),null!=e&&p&&p()}),!1}),0<s&&r.append($('<div class="seperater"/>')),r.append(e)}),a.find("#sum_withdraw").html(amountFormat(null,n)),a.find("#sum_deposit").html(amountFormat(null,m)),d.append(a)})}}