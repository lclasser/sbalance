<div page-declare=dpage class=sb-page onload=onPageLoad(this) onclose=onPageClose(this)><div id=list_items class=overflow-auto style=margin-bottom:40px></div></div><script>function onPageLoad(t){var i=t.getPage();i.getFrame().setMenuCenter("menu_center_apps.svg",function(){console.log("onsetMenuCenter"),window.popver("https://lclasser.github.io/sbalance/pages/main/popver/menu.setup.category.html",{callback:function(){o()}})});const l=`
    <div class="sb-card card">
        <div class="card-header">
            <img id="cate_icon" class="p-1" src="https://lclasser.github.io/sbalance/public/image/balance_category.svg">
            <div class="d-flex flex-column justify-content-center flex-grow-1 overflow-hidden">
                <div class="text-truncate" id="item_title"></div>
                <div class="text-truncate memo-text" id="item_owner"></div>
            </div>
            <div class="d-flex align-items-center flex-shrink-0">
                <button class="btn udpate-btn me-1" type="button" id="btn_modify">수정</button>
                <button class="btn insert-btn me-1" type="button" id="btn_insert">추가</button>

                <button type="button" class="transparent-bgcolor" 
                    data-bs-toggle="collapse" data-bs-target=".group_x" 
                    aria-expanded="false" aria-controls=".group_x">
                    <div class="collapse hide group_x"><img style="height:24px;" src="https://lclasser.github.io/sbalance/public/image/card_down.svg"></div>
                    <div class="collapse show group_x"><img style="height:24px;" src="https://lclasser.github.io/sbalance/public/image/card_up.svg"></div>
                </button>
            </div>
        </div>
        <div class="card-body p-1 collapse show group_x">
        </div>
    </div>`;const a=`
    <div class="row align-items-center m-0" style="min-height:54px;"">
        <div class="d-flex col-5"><span class="text-truncate" id="ci_name">분류</span></div>
        <div class="d-flex col" id="ci_type">종류</div>
        <div class="d-flex col-2 justify-content-end" id="ci_budget">목표</div>
    </div>
    `;function o(){var e=null,n=null;Promise.resolve().then(function(){return window.SBalance.request("/main/category/group/select").then(function(t){console.log("res:",t),e=t.data})}).then(function(){return window.SBalance.request("/main/category/item/select").then(function(t){n=t.data})}).then(function(){var c=i.find("#list_items"),s=(c.empty(),{});e.forEach(function(t){var e,n,i,a;s[t.cg_key]=s[t.cg_key]||(e=t,n=$(l),i="group_"+e.cg_key,a=e.cg_name,"L"==e.cg_type?(a=e.org_desc,n.find("#item_owner").html(`${e.org_user} (${e.org_email})`),n.find("#btn_modify").html("공유"),n.find("#btn_modify").removeClass("udpate-btn").addClass("shared-btn"),n.find("#item_title").html(a)):0<e.lnk_cnt?n.find("#item_title").html(`${a} <span class="memo-text">(${e.lnk_cnt})</span>`):n.find("#item_title").html(""+a),n.find(".group_x").removeClass("group_x").addClass(i),n.find('[data-bs-target=".group_x"]').attr("data-bs-target","."+i),n.find('[aria-controls=".group_x"]').attr("aria-controls",i),n.find("#btn_insert").click(function(){var t={title:`'${a}'의 분류 추가`,btn_confirm:"추가",cg_key:"L"==e.cg_type?e.org_key:e.cg_key,cg_type:e.cg_type};window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.setup_citem.html",t,function(t){null!=t&&o()})}),n.find("#btn_modify").click(function(){var t={title:"L"==e.cg_type?"공유 정보":"그룹 수정",cg_key:e.cg_key,org_key:e.org_key,cg_name:"L"==e.cg_type?e.org_desc:e.cg_name,cg_type:e.cg_type,cg_sort:e.cg_sort};window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.setup_cgroup.html",t,function(t){null!=t&&o()})}),n),c.append(s[t.cg_key])}),n.forEach(function(t){var e,n=s[t.cg_key];null!=n&&(n=n.find(".card-body"),e=t,(t=$(a)).find("#ci_name").html(e.ci_name),t.find("#ci_type").html(getStringByCateType(e.ci_type)),0!=toInteger(e.ci_budget)?t.find("#ci_budget").html(thousandFormatter(e.ci_budget)):t.find("#ci_budget").html(""),"L"==e.cg_type?t.find("#ci_name").addClass("share-text"):t.find("#ci_name").addClass("self-text"),t.click(function(){var t={cg_key:e.cg_key,cg_type:e.cg_type,ci_idx:e.ci_idx,ci_type:e.ci_type,ci_name:e.ci_name,ci_budget:toNumber(e.ci_budget),ci_sort:e.ci_sort,title:"분류 수정",btn_confirm:"수정"};"L"==e.cg_type&&(t.cg_key=e.cg_link),console.log("modify:",t),window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.setup_citem.html",t,function(t){null!=t&&o()})}),0<n.children().length&&n.append($('<div class="seperater"/>')),n.append(t))})})}o()}function onPageClose(t){stracer("page.category.html").dbg("onPageClose:",t)}</script>