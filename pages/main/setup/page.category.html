<div page-declare=dpage class=sb-page onload=onPageLoad(this) onclose=onPageClose(this)><div id=list_items class=overflow-auto style=margin-bottom:40px></div></div><script>function onPageLoad(t){var i=t.getPage();i.getFrame().setMenuCenter("menu_center_apps.svg",function(){stracer("page.category.html").log("onsetMenuCenter"),window.popver("https://lclasser.github.io/sbalance/pages/main/popver/menu.setup.category.html",{callback:function(){o()}})});const l=`
    <div class="sb-card card">
        <div class="card-header">
            <img id="cate_icon" class="p-1" src="https://lclasser.github.io/sbalance/public/image/balance_category.svg">
            <div class="d-flex flex-column justify-content-center flex-grow-1 overflow-hidden">
                <div class="text-truncate" id="item_title"></div>
                <div class="text-truncate memo-text" id="item_owner"></div>
            </div>
            <div class="d-flex align-items-center flex-shrink-0">
                <button class="btn update-btn me-1" type="button" id="btn_modify">수정</button>
                <button class="btn insert-btn me-1" type="button" id="btn_insert">추가</button>

                <button type="button" class="transparent-bgcolor" 
                    data-bs-toggle="collapse" data-bs-target=".group_x" 
                    aria-expanded="false" aria-controls=".group_x">
                    <div class="collapse hide group_x"><img style="height:24px;" src="https://lclasser.github.io/sbalance/public/image/card_down.svg"></div>
                    <div class="collapse show group_x"><img style="height:24px;" src="https://lclasser.github.io/sbalance/public/image/card_up.svg"></div>
                </button>
            </div>
        </div>
        <div class="card-body p-1 collapse show group_x">
        </div>
    </div>`;const c=`
    <div class="row align-items-center m-0" style="min-height:54px;"">
        <div class="d-flex col-5"><span class="text-truncate" id="ci_name">분류</span></div>
        <div class="d-flex col" id="ci_type">종류</div>
        <div class="d-flex col-2 justify-content-end" id="ci_budget">목표</div>
    </div>
    `;function o(){var e=null,a=null;Promise.resolve().then(function(){return window.SBalance.request("/main/category/group/list").then(function(t){stracer("page.category.html").log("group:",t),e=t.data})}).then(function(){return window.SBalance.request("/main/category/item/list").then(function(t){stracer("page.category.html").log("item:",t),a=t.data})}).then(function(){var n=i.find("#list_items"),s=(n.empty(),{});e.forEach(function(t){var e,a,i;s[t.cg_key]=s[t.cg_key]||(e=t,a=$(l),i="group_"+e.cg_key,e.cg_alias=e.cg_alias||e.grp_alias,"L"==e.cg_type?(a.find("#item_owner").html(`${e.usr_name} (${e.usr_email})`),a.find("#btn_modify").html("공유"),a.find("#btn_modify").removeClass("update-btn").addClass("shared-btn"),e.cg_alias==e.grp_alias?a.find("#item_title").html(""+e.cg_alias):a.find("#item_title").html(`${e.cg_alias} <span class="memo-text">(${e.grp_alias})</span>`),e.cg_perm===Permission.READ_WRITE?a.find("#btn_insert").removeAttr("disabled"):a.find("#btn_insert").attr("disabled","disabled")):0<e.lnk_cnt?a.find("#item_title").html(`${e.cg_alias} <span class="memo-text">(${e.lnk_cnt})</span>`):a.find("#item_title").html(""+e.cg_alias),a.find(".group_x").removeClass("group_x").addClass(i),a.find('[data-bs-target=".group_x"]').attr("data-bs-target","."+i),a.find('[aria-controls=".group_x"]').attr("aria-controls",i),a.find("#btn_insert").click(function(){var t={title:`'${e.cg_alias}'의 분류 추가`,btn_confirm:"추가",cg_key:e.cg_key,cg_type:e.cg_type};window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.setup_citem.html",t,function(t){null!=t&&o()})}),a.find("#btn_modify").click(function(){var t={title:"L"==e.cg_type?"공유 정보":"그룹 수정",cg_key:e.cg_key,cg_type:e.cg_type};window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.setup_cgroup.html",t,function(t){null!=t&&o()})}),a),n.append(s[t.cg_key])}),a.forEach(function(t){var e,a=s[t.cg_key];null!=a&&(a=a.find(".card-body"),e=t,(t=$(c)).find("#ci_name").html(e.ci_name),"L"==e.cg_type?t.find("#ci_name").addClass("share-text"):t.find("#ci_name").addClass("self-text"),t.find("#ci_type").html(getStringByCateType(e.ci_type)),0!=toInteger(e.ci_budget)?t.find("#ci_budget").html(thousandFormatter(e.ci_budget)):t.find("#ci_budget").html(""),t.click(function(){var t={title:"분류 수정",btn_confirm:"수정",cg_key:e.cg_key,ci_idx:e.ci_idx};stracer("page.category.html").log("modify:",t),window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.setup_citem.html",t,function(t){null!=t&&o()})}),0<a.children().length&&a.append($('<div class="seperater"/>')),a.append(t))})})}o()}function onPageClose(t){stracer("page.category.html").dbg("onPageClose:",t)}</script>