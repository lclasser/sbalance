<style>#card_list{margin-bottom:5rem}</style><div page-declare=dpage class=sb-page onload=onPageLoad(this) onclose=onPageClose(this)><div id=card_list></div></div><script>function onPageLoad(t){var c=t.getPage();c.getFrame().setMenuCenter("menu_center_apps.svg",function(){console.log("onsetMenuCenter"),window.popver("https://lclasser.github.io/sbalance/pages/main/popver/menu.setup.category.html",{callback:function(){l()}})});const s=`
    <div class="row card-header d-flex align-items-center m-0" style="height:35px;">
        <div class="col-auto p-0 pe-1"><button class="btn btn-warning btn-sm" type="button" id="btn_modify">수정</button></div>
        <div class="col-5 text-truncate p-1" id="item_title"></div>
        <div class="col text-truncate p-1 text-secondary" id="item_owner"></div>
        <div class="col-auto p-1" style="text-align: right;">
            <button class="btn btn-success btn-sm me-1" type="button" id="btn_insert">추가</button>

            <button type="button" class="transparent-bgcolor" 
                data-bs-toggle="collapse" data-bs-target=".group_x" 
                aria-expanded="false" aria-controls=".group_x">
                <div class="collapse hide group_x"><img style="height:24px;" src="https://lclasser.github.io/sbalance/public/image/card_down.svg"></div>
                <div class="collapse show group_x"><img style="height:24px;" src="https://lclasser.github.io/sbalance/public/image/card_up.svg"></div>
            </button>
        </div>
    </div>
    <div class="card-body p-0 collapse show group_x">
    </div>`;const i=`
    <div class="col-5 d-flex"><span class="text-truncate" id="ci_name">분류</span></div>
    <div class="col d-flex" id="ci_type">종류</div>
    <div class="col-2 d-flex justify-content-end" id="ci_budget">목표</div>
    `;function l(){var e=null,n=null;Promise.resolve().then(function(){return window.SBalance.request("/main/category/group/select").then(function(t){console.log("res:",t),e=t.data})}).then(function(){return window.SBalance.request("/main/category/item/select").then(function(t){n=t.data})}).then(function(){var a=c.find("#card_list"),o=(a.empty(),{});e.forEach(function(t){var e,n,c,i;o[t.cg_key]=o[t.cg_key]||(e=t,n=$("<div/>").addClass("sb-card card w-100 mb-1").html(s),c="group_"+e.cg_key,i=e.cg_name,"L"==e.cg_type?(i=e.org_desc,n.find("#item_owner").html(`${e.org_user} (${e.org_email})`),n.find("#btn_modify").html("공유"),n.find("#btn_modify").removeClass("btn-warning").addClass("btn-primary")):0<e.lnk_cnt&&n.find("#item_owner").html(`(${e.lnk_cnt})`),n.find("#item_title").html(i),n.find(".group_x").removeClass("group_x").addClass(c),n.find('[data-bs-target=".group_x"]').attr("data-bs-target","."+c),n.find('[aria-controls=".group_x"]').attr("aria-controls",c),n.find("#btn_insert").click(function(){var t={title:`'${i}'의 분류 추가`,btn_confirm:"추가",cg_key:"L"==e.cg_type?e.cg_name:e.cg_key,cg_type:e.cg_type};window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.setup_citem.html",t,function(t){null!=t&&l()})}),n.find("#btn_modify").click(function(){var t={title:"그룹 수정",cg_key:"L"==e.cg_type?e.cg_name:e.cg_key,cg_name:"L"==e.cg_type?e.org_desc:e.cg_name,cg_type:e.cg_type,cg_sort:e.cg_sort};window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.setup_cgroup.html",t,function(t){null!=t&&l()})}),n),a.append(o[t.cg_key])}),n.forEach(function(t){var e,n=o[t.cg_key];null!=n&&(n=n.find(".card-body"),e=t,(t=$('<div class="row align-items-center m-0 h-100"/>').css("min-height","54px").html(i)).find("#ci_name").html(e.ci_name),t.find("#ci_type").html(getStringByCateType(e.ci_type)),0!=toInteger(e.ci_budget)?t.find("#ci_budget").html(thousandFormatter(e.ci_budget)):t.find("#ci_budget").html(""),t.click(function(){var t={cg_key:e.cg_key,cg_type:e.cg_type,ci_idx:e.ci_idx,ci_type:e.ci_type,ci_name:e.ci_name,ci_budget:toNumber(e.ci_budget),ci_sort:e.ci_sort,title:"분류 수정",btn_confirm:"수정"};"L"==e.cg_type&&(t.cg_key=e.cg_link),console.log("modify:",t),window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.setup_citem.html",t,function(t){null!=t&&l()})}),0<n.children().length&&n.append($('<div class="seperater"/>')),n.append(t))})})}l()}function onPageClose(t){STracer("page.category.html").dbg("onPageClose:",t)}</script>