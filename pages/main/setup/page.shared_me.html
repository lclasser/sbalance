<div page-declare=dpage class=sb-page onload=onPageLoad(this) onclose=onPageClose(this)><div id=list_items class=overflow-auto style=margin-bottom:40px></div></div><script>function inquire_shared(l){window.SBalance.request("/main/shared/me").then(function(e){l.find("#list_items").empty(),stracer("page.shared_me.html").log("me:",e);e=Object.values(e.data);e.length<=0&&l.find("#list_items").html('<div class="row m-1 ms-4" style="height:30px;">공유된 정보가 없습니다.</div>');e.forEach(function(e,a){var t,i,s;e.length<=0||(a="user_"+a,(t=$(`
    <div class="sb-card card">
        <div class="card-header">
            <img class="p-1 pe-2" src="https://lclasser.github.io/sbalance/public/image/icon_share.svg">
            <div class="d-flex flex-column justify-content-center flex-grow-1 overflow-hidden">
                <div class="text-truncate" id="lnk_user"></div>
                <div class="text-truncate memo-text" id="lnk_email"></div>
                <input type="hidden" value="" id="share_key">
            </div>
            <div class="d-flex align-items-center flex-shrink-0">
                <button class="btn shared-btn me-1" type="button" id="btn_release">해제</button>

                <button type="button" class="transparent-bgcolor" 
                    id="item_collapse"
                    data-bs-toggle="collapse" data-bs-target=".group_x" 
                    aria-expanded="false" aria-controls=".group_x">
                    <div class="collapse hide group_x"><img style="height:24px;" src="https://lclasser.github.io/sbalance/public/image/card_down.svg"></div>
                    <div class="collapse show group_x"><img style="height:24px;" src="https://lclasser.github.io/sbalance/public/image/card_up.svg"></div>
                </button>
            </div>
        </div>
        <div class="card-body p-1 collapse show group_x">
        </div>
    </div>`)).find("#lnk_user").html(e[0].usr_name),t.find("#lnk_email").html(e[0].usr_email),t.find("#share_key").val(e[0].share_key),(i=t.find("#item_collapse")).attr("data-bs-target","."+a),i.attr("aria-controls","."+a),t.find(".group_x").removeClass("group_x").addClass(a),t.find(".shared-btn").click(function(){stracer("page.shared_me.html").log("공유 해제 click.");var t=$(this).parent().parent().find("#share_key").val(),e=$(this).parent().parent().find("#lnk_user").html(),a=$(this).parent().parent().find("#lnk_email").html();window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.confirm.html",{title:"공유 해제 확인",content:`"${e} (${a})" 와 모든 공유를 해제 하시겠습니까?`,btn_confirm:"해제",btn_cancel:"취소"},function(e,a){1==a&&window.SBalance.request("/main/shared/delete",{share_key:t}).then(function(e){null!=e&&(null!=e.error&&"Y"!=e.error.success?window.toast({title_class:"bg-danger text-white",title_text:$modal.find("#modal_title").text(),mesg_text:`모든 공유 해제를 실패 했습니다. (${e.error.message})`}):inquire_shared(l))})})}),s=t.find(".card-body"),e.forEach(function(a,e){var t=$(`
    <div class="row align-items-center m-0" style="min-height:54px;">
        <div class="d-flex align-items-center ps-1 pe-1 col-auto share-text" id="acc_company" style="width: 80px;">금융사</div>
        <div class="d-flex justify-content-center flex-column col">
            <div class="row text-truncate" id="acc_alias">별칭</div>
            <div class="row text-truncate memo-text" id="item_memo"></div>
        </div>
        <div class="d-flex align-items-center ps-1 pe-1 col-auto" id="acc_perm">권한</div>
    </div>`);switch(t.attr("type",a.type),a.type){case"A":t.find("#acc_company").html(a.acc_company),t.find("#acc_perm").html(getPermissionString(a.lnk_perm)),t.find("#acc_alias").html(a.acc_alias),t.attr("acc_key",a.acc_key),t.click(function(){var e={acc_key:a.acc_key};stracer("page.shared_me.html").log("account:",e),window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.setup_wallet.html",e,function(e,a){null!=a&&inquire_shared(l)})});break;case"C":t.find("#acc_company").html("카테고리"),t.find("#acc_perm").html(getPermissionString(a.lnk_perm)),t.find("#acc_alias").html(a.cg_alias),t.attr("cg_key",a.cg_key),t.click(function(){var e={title:"L"==a.cg_type?"공유 정보":"그룹 수정",cg_key:a.cg_key,cg_type:a.cg_type};stracer("page.shared_me.html").log("category:",e),window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.setup_cgroup.html",e,function(e,a){null!=a&&inquire_shared(l)})})}0<s.children().length&&s.append($('<div class="seperater"/>')),s.append(t)}),l.find("#list_items").append(t))})})}function onPageLoad(e){e=e.getPage();stracer("page.shared_me.html").dbg("onPageLoad..."),inquire_shared(e)}function onPageClose(e){stracer("page.shared_me.html").dbg("onPageClose:",e)}</script>