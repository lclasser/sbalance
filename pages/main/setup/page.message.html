
<div page-declare="dpage" class="w-100 h-100" onload="onPageLoad(this);">
    <ul class="list-group">
        <li class="list-group-item fs-3" style="height:50px;" onclick="">문자 수신 설정</li>
        <li class="list-group-item fs-3" style="height:50px;" id="msg_read">문자 읽기</li>
    </ul>
</div>

<script>
/*
- 문자 수신 설정
    1. SMS 수신 여부
    2. SMS 수신 알림 여부
    3. 수신 거부 전화번호
*/
function onPageLoad(epage)
{
    var spage = epage.getPage();

    spage.find("#msg_read").click(function() {
        if( window.SBalance.getMode() == 'web' )
        {
            var now_date = new Date();
            var msg_date = ''
                + now_date.getFullYear()
                + ('0' + (now_date.getMonth()+1).toString()).slice(-2)
            ;
            var str_month = ''
                + ('0' + (now_date.getMonth()+1).toString()).slice(-2)
            ;
            var pos;
            var lists = [];
            for(pos=0; pos< 1; pos++ ) {
                lists.push({
                    "usr_key": window.SBalance.getSignin().usr_key,
                    "dev_key":"a024124e-e94c-3996-b21d-2b3b989661bf",
                    "msg_phone":"15447200",
                    "msg_date":msg_date+"16", "msg_time":`0152${("00"+pos).slice(-2)}`,
                    "msg_body":`[Web발신]
신한카드(6441)승인 최*호 30,000원(일시불)${str_month}/16 01:52 고양휴게소(  누적7,110,3${("00"+pos).slice(-2)}원  \n`
                    ,"msg_event":"onRead"
                });
                lists.push({
                    "usr_key": window.SBalance.getSignin().usr_key,
                    "dev_key":"a024124e-e94c-3996-b21d-2b3b989661bf",
                    "msg_phone":"15447200",
                    "msg_date":msg_date+"12", "msg_time":`0152${("00"+pos).slice(-2)}`,
                    "msg_body":`[Web발신]
신한카드(1580)승인 최*호       27,490원(일시불)${str_month}/12 21:44  쿠팡          누적6,905,354원  \n`
                    ,"msg_event":"onRead"
                });
                lists.push({
                    "usr_key": window.SBalance.getSignin().usr_key,
                    "dev_key":"a024124e-e94c-3996-b21d-2b3b989661bf",
                    "msg_phone":"15447200",
                    "msg_date":msg_date+"14", "msg_time":`0152${("00"+pos).slice(-2)}`,
                    "msg_body":`[Web발신]
[신한체크승인]     최*호(8273) ${str_month}/14                 15:07  (금액)5,700원 티머니 법인택시  \n`
                    ,"msg_event":"onRead"
                });
            }

            var titems = [
                "[Web발신] 신한카드승인거절   잔액한도부족   $MONTH/14 17:59     (일시불)1,800,000원 풀문(FullMoo",
                "[Web발신] [신한카드]         자동납부       정상승인 최정호님    $MONTH/10 (일시불)       7,750원 서울도시가스(주)",
                "[web발신] 신한카드(6441)승인 최*호님       (주)에스케이브  81,180원 정상 승인",
                "[Web발신] 신한카드(0380)승인 최*호님       SK텔레콤        78,100원 정상 승인",
                "[Web발신] 신한카드(0380)승인 최*호님       아파트 관리비  173,720원 정상승인 되었습니다.",
                "[Web발신] [신한체크승인]     최*호(8273)    $MONTH/14 15:07    (금액)5,700원 티머니 법인택시",
                "[Web발신] 신한카드(6441)승인 최*호         10,400원(일시불)$MONTH/19 03:22 gs25운정비발 누적4,051,421원",
            ];
            
            var tpos;
            for( tpos=0; tpos< titems.length; tpos++ ) {
                titems[tpos] = titems[tpos].replace("$MONTH", str_month);
                lists.push({
                    "usr_key": window.SBalance.getSignin().usr_key,
                    "dev_key":"a024124e-e94c-3996-b21d-2b3b989661bf",
                    "msg_phone":"15447200",
                    "msg_date":msg_date+"14", "msg_time":`0152${("00"+pos).slice(-2)}`,
                    "msg_body":titems[tpos],
                    "msg_event":"onRead"
                });
            }

            var inbound = {
                date1: msg_date.slice(0,4) + '01',
                date2: msg_date.slice(0,4) + '31',
                lists: lists,
            };
            spage.getFrame().openPage("/main/setup/page.message_list.html", "문자 읽기", inbound);
            return;
        }

        window.openModal('/main/modal/modal.date_range.html', null, function(result) {
            if( result != null ) {
                console.log("date range:", result);

                // result.date1, result.date2
                var inbound = {
                    date1: formaterFmtDate_fromDate(result.date1),
                    date2: formaterFmtDate_fromDate(result.date2),
                };
                var lists = [];
                window.SBalance.readMessage(inbound, function(readJson) {
                    // console.log("onRead:" + JSON.stringify(readJson));
                    lists.push(readJson);
                }, function(readCount) {
                    if( readCount == null ) {
                        window.toast({
                            title_class: "bg-danger text-white",
                            title_text: "문자 읽기",
                            mesg_text: "데이터가 없습니다.",
                        });
                        return;
                    }
                    console.log("onFinish:["+readCount+"] " + lists.length);

                    inbound.lists = lists;
                    spage.getFrame().openPage("/main/setup/page.message_list.html", "문자 읽기", inbound);
                });
            } else {
            }
        });
    });
}

</script>
