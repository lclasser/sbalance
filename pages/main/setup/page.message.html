<div page-declare=dpage class=sb-page onload=onPageLoad(this)><ul class="sb-list sb-menu"><li class=list-line><li class=list-row><div class=list-head page-link=https://lclasser.github.io/sbalance/pages/main/setup/page.message_setup.html><div class=menu-text>SMS 문자 설정</div><div class=memo-text>SMS,GPS 등 수신 설정</div></div><li class=list-line><li class=list-row id=msg_read><div class=list-head><div class=menu-text>SMS 문자 읽기</div><div class=memo-text>월단위로 장치에 저장된 SMS문자 불러오기 (미수신 문자 읽기)</div></div><li class=list-line><li class=list-row id=msg_down><div class=list-head><div class=menu-text>Excel 받기</div><div class=memo-text>월단위로 저장된 내역을 Excel 다운로드</div></div></ul></div><script src=https://lclasser.github.io/sbalance/vendor/xlsx.mini.min.js></script><script>function onPageLoad(e){var o=e.getPage();stracer("page.message.html").log("page.message.html"),o.find("#msg_read").click(function(){window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.month_select.html",{desc:o.find("#msg_read .menu-text").html()},function(e,t){var a,s,n;null!=t&&(stracer("page.message.html").log("date range:",t),t.year=t.year.toString().padStart(4,"0").split(-4),t.month=t.month.toString().padStart(2,"0").split(-2),a=new Date(t.year,t.month-1,1),t=new Date(t.year,t.month,0),s={date1:formaterFmtDate_fromDate(a),date2:formaterFmtDate_fromDate(t)},n=[],window.SBalance.readMessage(s,function(e){n.push(e)},function(e){null==e?window.toast({title_class:"bg-danger text-white",title_text:"문자 읽기",mesg_text:"데이터가 없습니다."}):(stracer("page.message.html").log("onFinish:["+e+"] "+n.length),s.lists=n,o.getFrame().openPage("https://lclasser.github.io/sbalance/pages/main/setup/page.message_read.html","문자 읽기",s))}))})}),o.find("#msg_down").click(function(){window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.month_select.html",{desc:o.find("#msg_down .menu-text").html()},function(e,s){var t,a;if(null!=s)return stracer("page.message.html").log("date range:",s),s.year=s.year.toString().padStart(4,"0").split(-4),s.month=s.month.toString().padStart(2,"0").split(-2),a=new Date(s.year,s.month-1,1),t=new Date(s.year,s.month,0),a={date1:formaterFmtDate_fromDate(a),date2:formaterFmtDate_fromDate(t),type:"download"},window.SBalance.request("/main/message/list",a).then(function(e){if(stracer("page.message.html").log("/main/message/list:",e),null==e.data||e.data.length<=0)window.toast({title_class:"bg-danger text-white",title_text:"문자 읽기",mesg_text:"데이터가 없습니다."});else{const a=`${s.year}년${s.month}월_messages.xlsx`;var t=XLSX.utils.book_new(),e=XLSX.utils.json_to_sheet(e.data),e=(XLSX.utils.book_append_sheet(t,e,null),XLSX.writeFile(t,a,{compression:!0,base64:"base64"})),t=new XMLHttpRequest;t.open("GET",e,!0),t.setRequestHeader("Content-type","image/gif"),t.responseType="blob",t.onload=function(e){var t;stracer("modal.date_range.html").log("xhr.onload...",this.status),200==this.status&&((t=new FileReader).readAsDataURL(this.response),t.onloadend=function(){window.SBalance.storeFile(a,t.result,"을 다운로드 완료 되었습니다.")})},stracer("modal.date_range.html").log("xhr.send.",this.status),t.send()}})})})}</script>