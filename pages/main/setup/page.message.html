<div page-declare=dpage class=sb-page onload=onPageLoad(this)><ul class="sb-list sb-menu"><li class=list-line><li class=list-row><div class=list-item page-link=https://lclasser.github.io/sbalance/pages/main/setup/page.message_setup.html><div class=menu-text>SMS 문자 설정</div><div class=memo-text>SMS,GPS 등 수신 설정</div></div><li class=list-line><li class=list-row id=msg_read><div class=list-item><div class=menu-text>SMS 문자 읽기</div><div class=memo-text>월단위로 장치에 저장된 SMS문자 불러오기 (미수신 문자 읽기)</div></div><li class=list-line><li class=list-row id=msg_down><div class=list-item><div class=menu-text>Excel 받기</div><div class=memo-text>월단위로 저장된 내역을 Excel 다운로드</div></div></ul></div><script src=https://lclasser.github.io/sbalance/vendor/xlsx.mini.min.js></script><script>function onPageLoad(e){var l=e.getPage();stracer("page.message.html").log("page.message.html"),l.find("#msg_read").click(function(){if("web1"==window.SBalance.getMode()){for(var e=new Date,t=""+e.getFullYear()+("0"+(e.getMonth()+1).toString()).slice(-2),a=""+("0"+(e.getMonth()+1).toString()).slice(-2),s=[],n=0;n<1;n++)s.push({usr_key:window.SBalance.getSignin().usr_key,dev_key:"a024124e-e94c-3996-b21d-2b3b989661bf",msg_phone:"15447200",msg_date:t+"16",msg_time:"0152"+("00"+n).slice(-2),msg_body:`[Web발신]
신한카드(6441)승인 최*호 30,000원(일시불)${a}/16 01:52 고양휴게소(  누적7,110,3${("00"+n).slice(-2)}원  
`,msg_event:"onRead"}),s.push({usr_key:window.SBalance.getSignin().usr_key,dev_key:"a024124e-e94c-3996-b21d-2b3b989661bf",msg_phone:"15447200",msg_date:t+"12",msg_time:"0152"+("00"+n).slice(-2),msg_body:`[Web발신]
신한카드(1580)승인 최*호       27,490원(일시불)${a}/12 21:44  쿠팡          누적6,905,354원  
`,msg_event:"onRead"}),s.push({usr_key:window.SBalance.getSignin().usr_key,dev_key:"a024124e-e94c-3996-b21d-2b3b989661bf",msg_phone:"15447200",msg_date:t+"14",msg_time:"0152"+("00"+n).slice(-2),msg_body:`[Web발신]
[신한체크승인]     최*호(8273) ${a}/14                 15:07  (금액)5,700원 티머니 법인택시  
`,msg_event:"onRead"});for(var o=["[Web발신] 신한카드(0380)승인 최*호 7,100원(일시불)06/27 18:06 씨유문래벤처 누적3,686,870원","[Web발신] [신한카드]         자동납부       정상승인 최정호님    $MONTH/10 (일시불)       7,750원 서울도시가스(주)","[web발신] 신한카드(6441)승인 최*호님       (주)에스케이브  81,180원 정상 승인","[Web발신] 신한카드(0380)승인 최*호님       SK텔레콤        78,100원 정상 승인","[Web발신] 신한카드(0380)승인 최*호님       아파트 관리비  173,720원 정상승인 되었습니다.","[Web발신] [신한체크승인]     최*호(8273)    $MONTH/14 15:07    (금액)5,700원 티머니 법인택시","[Web발신] 신한카드(6441)승인 최*호         10,400원(일시불)$MONTH/19 03:22 gs25운정비발 누적4,051,421원"],g=0;g<o.length;g++)o[g]=o[g].replace("$MONTH",a),s.push({usr_key:window.SBalance.getSignin().usr_key,dev_key:"a024124e-e94c-3996-b21d-2b3b989661bf",msg_phone:"15447200",msg_date:t+"14",msg_time:"0152"+("00"+n).slice(-2),msg_body:o[g],msg_event:"onRead"});s.push({usr_key:window.SBalance.getSignin().usr_key,dev_key:"a024124e-e94c-3996-b21d-2b3b989661bf",msg_phone:"15447200",msg_date:"20230627",msg_time:"0152"+("00"+n).slice(-2),msg_body:o[0],msg_event:"onRead"}),s.push({usr_key:"472b6f8159f4a1943498d3f30e333570",dev_key:"472b6f8159f4a1943498d3f30e333570",msg_phone:"12345678",msg_date:"20231002",msg_time:"000347",msg_body:"Sample Message",msg_event:"onRead"});e={date1:t.slice(0,4)+"01",date2:t.slice(0,4)+"31",lists:s};l.getFrame().openPage("https://lclasser.github.io/sbalance/pages/main/setup/page.message_read.html","문자 읽기",e)}else window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.month_select.html",null,function(e){var t,a;null!=e?(stracer("page.message.html").log("date range:",e),e.year=e.year.toString().padStart(4,"0").split(-4),e.month=e.month.toString().padStart(2,"0").split(-2),t={date1:e.year+e.month+"00",date2:e.year+e.month+"99"},a=[],window.SBalance.readMessage(t,function(e){a.push(e)},function(e){null==e?window.toast({title_class:"bg-danger text-white",title_text:"문자 읽기",mesg_text:"데이터가 없습니다."}):(stracer("page.message.html").log("onFinish:["+e+"] "+a.length),t.lists=a,l.getFrame().openPage("https://lclasser.github.io/sbalance/pages/main/setup/page.message_read.html","문자 읽기",t))})):window.toast({title_class:"bg-danger text-white",title_text:"문자 읽기",mesg_text:"데이터가 없습니다."})})}),l.find("#msg_down").click(function(){window.openModal("https://lclasser.github.io/sbalance/pages/main/modal/modal.month_select.html",{desc:l.find("#msg_down .menu-text").html()},function(a){var e;if(null!=a)return stracer("page.message.html").log("date range:",a),a.year=a.year.toString().padStart(4,"0").split(-4),a.month=a.month.toString().padStart(2,"0").split(-2),e={date1:a.year+a.month+"00",date2:a.year+a.month+"99",type:"download"},window.SBalance.request("/main/message/list",e).then(function(e){stracer("page.message.html").log("/main/message/list:",e);const s=formaterFmtDate_fromDate(a.date1)+"_messages.xlsx";var t=XLSX.utils.book_new(),e=XLSX.utils.json_to_sheet(e.data),e=(XLSX.utils.book_append_sheet(t,e,null),XLSX.writeFile(t,s,{base64:"base64"})),t=(console.log("based64:",e),new XMLHttpRequest);t.open("GET",e,!0),t.setRequestHeader("Content-type","image/gif"),t.responseType="blob",t.onload=function(e){var t,a;console.log("xhr.onload...",this.status),200==this.status&&(t=this.response,(a=new FileReader).readAsDataURL(t),a.onloadend=function(){base64data=a.result,console.log("base64data:",base64data.length,base64data),window.SBInterface.storeFile(s,base64data,"을 다운로드 완료 되었습니다."),console.log("storeFiled.")})},t.send(),console.log("xhr.send...")})})})}</script>