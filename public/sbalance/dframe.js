const _common_page={_event_function2(e,n,t){e=$._data(e,"events");if(stracer("_event_function2").log("event:",e),e&&null!=e[n]&&(stracer("_event_function2").frm("events :",e),1==e[n][0].handler(jQuery.Event(n),t)))return!0},_event_function(e,r){e.each(function(e,n){var t=Function(n.getAttribute(r));if(null!=t)return t.call(n)})}};function dframeInitialize(e){e=dframeCreate(e,null);return window.dframeInitialize=null,stracer("pageAlloc").frm("initialize page.js $(function() {..."),e}function dframeCreate(e,n){var t=null;return(t=null!=n?n.find("#"+e):$("#"+e)).attr("page-declare","dframe"),{_element_id:e,_history:[],_$body:t,_owner:n,get$body:function(){return this._$body},getOwner:function(){return this._owner},send:function(e,n){var t,r=$("[page-declare]"),a=r.length-1;for(stracer("frameAlloc").frm("send $parray:",r.length);0<=a;a--)if(t=r[a],null!=(t=$(t).triggerHandler(jQuery.Event(e),n)))return t;$(window.document).trigger(jQuery.Event(e),n)},getReference:window.SBalance.getReference,makePageLink:function(e){var n=this;null!=(e=e||n._$body)&&(stracer("frameAlloc").frm("makePageLink:",n,e.find("[page-link]")),e.find("[page-link]").on("click",function(){stracer("frameAlloc").frm("page-link click...");var e=$(this).find(".menu-text");null!=e&&0<e.length?n.openPage($(this).attr("page-link"),e.text(),$(this)):n.openPage($(this).attr("page-link"),$(this).text(),$(this))}))},makePageInclude:function(e){var n;if(null!=(e=e||this._$body))return n=Promise.resolve(),e.find("[page-include]").each(function(e,t){var r=$(t).attr("page-include");n=n.then(function(){return new Promise(function(n,e){stracer("makePageInclude").log("page loaded:",r),$.get(r,function(e){$(t).removeAttr(tag_name,""),$(t).html(e),n()})})})}),n},getHistory:function(){return this._history},addHistory:function(e){this._history.push(e)},popHistory:function(){var e=this,n=(stracer("frameAlloc").frm("backHistory...",e._history),e._history.length-1);if(!(n<=0))return e._history.pop(),e._history[n-1]},on:function(e,t){var r=this;return this._$body.on(e,function(e,n){return t.call(r,e,n)}),this},openPage:function(n,e,r,a){var i=this;try{if(null==i._$body)throw new Error("self._$body: invalid body.");if(null==n)throw new Error("self.openPage: invalid page_file.")}catch(e){return void stracer("openPage").err(e)}n="object"==typeof n?(e=n.title,n.file):(e=e&&e.trim(),n&&n.trim());var o=dpageCreate(e,n,r,i),e=(SBalance.setTimewait(!0),stracer("openPage").frm(`0.2 [${i._element_id}] : get~~~`,i._element_id),n);return $.get(e,function(e){try{var t=i._$body.children("[page-declare='dpage']");t&&0<t.length&&(stracer("openPage").frm(`0.5 [${i._element_id}]: onclose trigger.`,t),i._$body.triggerHandler(jQuery.Event("page_close"),t[0]&&t[0].getPage())),stracer("openPage").frm(`1.0 [${i._element_id}] : body.thml.`),i._$body.html(e),(t=o.$page=i._$body.children("[page-declare='dpage']")).each(function(e,n){stracer("openPage").frm(`2.0 [${i._element_id}]: element link.`,t),n.getPage=function(){return o},n.getParam=function(){return r}}),stracer("openPage").frm(`3.0 [${i._element_id}]: onPageOpen.`,t),null==a?i._$body.triggerHandler(jQuery.Event("page_open"),o,r):(a(o),a=null),i.makePageInclude(i._$body).then(function(){stracer("openPage").frm(`6.0 [${i._element_id}]: onPageLoad...`),i._$body.triggerHandler(jQuery.Event("page_load"),o)}),stracer("openPage").frm(`4.0 [${i._element_id}]: onload trigger (before).`,t),_common_page._event_function(t,"onopen"),i._$body.ready(function(){stracer("openPage").frm(`12 [${i._element_id}]: onPageReady...`),i._$body.triggerHandler(jQuery.Event("page_ready"),o),_common_page._event_function(t,"onload")})}catch(e){stracer("openPage").err(`error[${n}]:`,e),o.error=e,a&&a(o)}stracer("openPage").frm(`5.0 [${i._element_id}]: openPage finish.`,t),SBalance.setTimewait(!1)}).catch(function(e){SBalance.setTimewait(!1),stracer("openPage").err(`response.catch[${n}]:`,e),401==e.status&&(window.location="/")}),o}}}